<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - stripped_conv.info - modules/perception/camera/lib/obstacle/transformer/multicue/obj_mapper.cc</title>
  <link rel="stylesheet" type="text/css" href="../../../../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../../../../index.html">top level</a> - <a href="index.html">modules/perception/camera/lib/obstacle/transformer/multicue</a> - obj_mapper.cc<span style="font-size: 80%;"> (source / <a href="obj_mapper.cc.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">stripped_conv.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">241</td>
            <td class="headerCovTableEntry">247</td>
            <td class="headerCovTableEntryHi">97.6 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2020-05-21 16:34:32</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">8</td>
            <td class="headerCovTableEntry">8</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">246</td>
            <td class="headerCovTableEntry">462</td>
            <td class="headerCovTableEntryLo">53.2 %</td>
          </tr>
          <tr><td><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : #include &quot;cyber/common/log.h&quot;</a>
<span class="lineNum">       2 </span>                :            : /******************************************************************************
<span class="lineNum">       3 </span>                :            :  * Copyright 2018 The Apollo Authors. All Rights Reserved.
<span class="lineNum">       4 </span>                :            :  *
<span class="lineNum">       5 </span>                :            :  * Licensed under the Apache License, Version 2.0 (the License);
<span class="lineNum">       6 </span>                :            :  * you may not use this file except in compliance with the License.
<span class="lineNum">       7 </span>                :            :  * You may obtain a copy of the License at
<span class="lineNum">       8 </span>                :            :  *
<span class="lineNum">       9 </span>                :            :  * http://www.apache.org/licenses/LICENSE-2.0
<span class="lineNum">      10 </span>                :            :  *
<span class="lineNum">      11 </span>                :            :  * Unless required by applicable law or agreed to in writing, software
<span class="lineNum">      12 </span>                :            :  * distributed under the License is distributed on an AS IS BASIS,
<span class="lineNum">      13 </span>                :            :  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class="lineNum">      14 </span>                :            :  * See the License for the specific language governing permissions and
<span class="lineNum">      15 </span>                :            :  * limitations under the License.
<span class="lineNum">      16 </span>                :            :  *****************************************************************************/
<span class="lineNum">      17 </span>                :            : #include &quot;modules/perception/camera/lib/obstacle/transformer/multicue/obj_mapper.h&quot;
<span class="lineNum">      18 </span>                :            : 
<span class="lineNum">      19 </span>                :            : namespace apollo {
<span class="lineNum">      20 </span>                :            : namespace perception {
<a name="21"><span class="lineNum">      21 </span>                :            : namespace camera {</a>
<span class="lineNum">      22 </span>                :            : 
<span class="lineNum">      23 </span>                :<span class="lineCov">          2 : void ObjMapperParams::set_default() {</span>
<span class="lineNum">      24 </span>[<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>][<span class="branchCov" title="Branch 6 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]:<span class="lineCov">          2 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: ObjMapperParams::set_default&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 9 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>][<span class="branchCov" title="Branch 12 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 13 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 15 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 16 was not taken"> - </span>][<span class="branchCov" title="Branch 18 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 19 was not taken"> - </span>]
<span class="lineNum">      25 </span>                :            : 
<span class="lineNum">      26 </span>                :<span class="lineCov">          2 :   nr_bins_z = 15;</span>
<span class="lineNum">      27 </span>                :<span class="lineCov">          2 :   nr_bins_ry = 36;</span>
<span class="lineNum">      28 </span>                :<span class="lineCov">          2 :   boundary_len = 20;</span>
<span class="lineNum">      29 </span>                :<span class="lineCov">          2 :   max_nr_iter = 10;</span>
<span class="lineNum">      30 </span>                :            : 
<span class="lineNum">      31 </span>                :<span class="lineCov">          2 :   small_bbox_height = 50.0f;</span>
<span class="lineNum">      32 </span>                :<span class="lineCov">          2 :   factor_small = 0.6f;</span>
<span class="lineNum">      33 </span>                :<span class="lineCov">          2 :   learning_r = 0.7f;</span>
<span class="lineNum">      34 </span>                :<span class="lineCov">          2 :   reproj_err = 4 * sqrtf(2.0f);</span>
<span class="lineNum">      35 </span>                :<span class="lineCov">          2 :   rz_ratio = 0.1f;</span>
<span class="lineNum">      36 </span>                :<span class="lineCov">          2 :   abnormal_h_veh = 0.8f;</span>
<span class="lineNum">      37 </span>                :<span class="lineCov">          2 :   stable_w = 0.5f;</span>
<span class="lineNum">      38 </span>                :<span class="lineCov">          2 :   occ_ratio = 0.9f;</span>
<span class="lineNum">      39 </span>                :<span class="lineCov">          2 :   depth_min = 0.1f;</span>
<span class="lineNum">      40 </span>                :<span class="lineCov">          2 :   dist_far = 100.0f;</span>
<span class="lineNum">      41 </span>                :<span class="lineCov">          2 :   eps_mapper = 1e-5f;</span>
<span class="lineNum">      42 </span>                :            : 
<span class="lineNum">      43 </span>                :<span class="lineCov">          2 :   iou_suc = 0.5f;</span>
<span class="lineNum">      44 </span>                :<span class="lineCov">          2 :   iou_high = 0.7f;</span>
<span class="lineNum">      45 </span>                :<span class="lineCov">          2 :   angle_resolution_degree = 10.0f;</span>
<span class="lineNum">      46 </span>                :            : 
<span class="lineNum">      47 </span>[<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>][<span class="branchCov" title="Branch 6 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]:<span class="lineCov">          2 :    AINFO&lt;&lt;&quot;(DMCZP) LeaveMethod: ObjMapperParams::set_default&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 9 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>][<span class="branchCov" title="Branch 12 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 13 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 15 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 16 was not taken"> - </span>][<span class="branchCov" title="Branch 18 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 19 was not taken"> - </span>]
<a name="48"><span class="lineNum">      48 </span>                :<span class="lineCov">          2 :  }</span></a>
<span class="lineNum">      49 </span>                :            : 
<span class="lineNum">      50 </span>                :<span class="lineCov">         40 : bool ObjMapper::SolveCenterFromNearestVerticalEdge(const float *bbox,</span>
<span class="lineNum">      51 </span>                :            :                                                    const float *hwl, float ry,
<span class="lineNum">      52 </span>                :            :                                                    float *center,
<span class="lineNum">      53 </span>                :            :                                                    float *center_2d) const {
<span class="lineNum">      54 </span>[<span class="branchCov" title="Branch 1 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         40 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: ObjMapper::SolveCenterFromNearestVerticalEdge&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<span class="lineNum">      55 </span>                :            : 
<span class="lineNum">      56 </span>                :<span class="lineCov">         40 :   center[0] = center[1] = center[2] = 0.0f;</span>
<span class="lineNum">      57 </span>                :<span class="lineCov">         40 :   float height_bbox = bbox[3] - bbox[1];</span>
<span class="lineNum">      58 </span>                :<span class="lineCov">         40 :   float width_bbox = bbox[2] - bbox[0];</span>
<span class="lineNum">      59 </span>[<span class="branchCov" title="Branch 0 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 40 times"> + </span>]:<span class="lineCov">         40 :   if (width_bbox &lt;= 0.0f || height_bbox &lt;= 0.0f) {</span>
<span class="lineNum">      60 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AERROR &lt;&lt; &quot;width or height of bbox is 0&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>][<span class="branchNoExec" title="Branch 17 was not executed"> # </span><span class="branchNoExec" title="Branch 18 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 20 was not executed"> # </span><span class="branchNoExec" title="Branch 21 was not executed"> # </span>]
<span class="lineNum">      61 </span>                :            :     
<span class="lineNum">      62 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :   AINFO&lt;&lt;&quot;(DMCZP) (return) LeaveMethod: ObjMapper::SolveCenterFromNearestVerticalEdge&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>][<span class="branchNoExec" title="Branch 17 was not executed"> # </span><span class="branchNoExec" title="Branch 18 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 20 was not executed"> # </span><span class="branchNoExec" title="Branch 21 was not executed"> # </span>]
<span class="lineNum">      63 </span>                :<span class="lineNoCov">          0 :   return false;</span>
<span class="lineNum">      64 </span>                :            :   }
<span class="lineNum">      65 </span>                :            : 
<span class="lineNum">      66 </span>[<span class="branchCov" title="Branch 1 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 40 times"> + </span>]:<span class="lineCov">         40 :   if (common::IRound(bbox[3]) &gt;= height_ - 1) {</span>
<span class="lineNum">      67 </span>                :<span class="lineNoCov">          0 :     height_bbox /= params_.occ_ratio;</span>
<span class="lineNum">      68 </span>                :            :   }
<span class="lineNum">      69 </span>                :            : 
<span class="lineNum">      70 </span>                :<span class="lineCov">         40 :   float f = (k_mat_[0] + k_mat_[4]) / 2;</span>
<span class="lineNum">      71 </span>        [<span class="branchCov" title="Branch 1 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         40 :   float depth = f * hwl[0] * common::IRec(height_bbox);</span>
<span class="lineNum">      72 </span>                :            : 
<span class="lineNum">      73 </span>                :            :   // compensate from the nearest vertical edge to center
<span class="lineNum">      74 </span>        [<span class="branchCov" title="Branch 1 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         40 :   const float PI = common::Constant&lt;float&gt;::PI();</span>
<span class="lineNum">      75 </span>        [<span class="branchCov" title="Branch 1 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         40 :   float theta_bbox = static_cast&lt;float&gt;(atan(hwl[1] * common::IRec(hwl[2])));</span>
<span class="lineNum">      76 </span>                :            :   float radius_bbox =
<span class="lineNum">      77 </span>[<span class="branchCov" title="Branch 1 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         40 :       common::ISqrt(common::ISqr(hwl[2] / 2) + common::ISqr(hwl[1] / 2));</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">      78 </span>                :            : 
<span class="lineNum">      79 </span>                :<span class="lineCov">         40 :   float abs_ry = fabsf(ry);</span>
<span class="lineNum">      80 </span>        [<span class="branchCov" title="Branch 1 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         40 :   float theta_z = std::min(abs_ry, PI - abs_ry) + theta_bbox;</span>
<span class="lineNum">      81 </span>        [<span class="branchCov" title="Branch 1 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         40 :   theta_z = std::min(theta_z, PI - theta_z);</span>
<span class="lineNum">      82 </span>                :<span class="lineCov">         40 :   depth += static_cast&lt;float&gt;(fabs(radius_bbox * sin(theta_z)));</span>
<span class="lineNum">      83 </span>                :            : 
<span class="lineNum">      84 </span>                :            :   // back-project to solve center
<span class="lineNum">      85 </span>                :<span class="lineCov">         40 :   center_2d[0] = (bbox[0] + bbox[2]) / 2;</span>
<span class="lineNum">      86 </span>                :<span class="lineCov">         40 :   center_2d[1] = (bbox[1] + bbox[3]) / 2;</span>
<span class="lineNum">      87 </span>        [<span class="branchCov" title="Branch 0 was taken 24 times"> + </span><span class="branchCov" title="Branch 1 was taken 16 times"> + </span>]:<span class="lineCov">         40 :   if (hwl[1] &gt; params_.stable_w) {</span>
<span class="lineNum">      88 </span>        [<span class="branchCov" title="Branch 1 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         24 :     GetCenter(bbox, depth, ry, hwl, center, center_2d);</span>
<span class="lineNum">      89 </span>                :            :   } else {
<span class="lineNum">      90 </span>                :<span class="lineCov">         16 :     center[2] = depth;</span>
<span class="lineNum">      91 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :     UpdateCenterViaBackProjectZ(bbox, hwl, center_2d, center);</span>
<span class="lineNum">      92 </span>                :            :   }
<span class="lineNum">      93 </span>                :            : 
<span class="lineNum">      94 </span>                :            :   
<span class="lineNum">      95 </span>[<span class="branchCov" title="Branch 1 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         40 :   AINFO&lt;&lt;&quot;(DMCZP) (return) LeaveMethod: ObjMapper::SolveCenterFromNearestVerticalEdge&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 40 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<span class="lineNum">      96 </span>                :<span class="lineCov">         40 :   return center[2] &gt; params_.depth_min;</span>
<a name="97"><span class="lineNum">      97 </span>                :            :  }</a>
<span class="lineNum">      98 </span>                :            : 
<span class="lineNum">      99 </span>                :<span class="lineCov">         29 : bool ObjMapper::Solve3dBboxGivenOneFullBboxDimensionOrientation(</span>
<span class="lineNum">     100 </span>                :            :     const float *bbox, const float *hwl, float *ry, float *center) {
<span class="lineNum">     101 </span>[<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         29 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: ObjMapper::Solve3dBboxGivenOneFullBboxDimensionOrientation&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<span class="lineNum">     102 </span>                :            : 
<span class="lineNum">     103 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :   const float PI = common::Constant&lt;float&gt;::PI();</span>
<span class="lineNum">     104 </span>                :<span class="lineCov">         29 :   const float PI_HALF = PI / 2;</span>
<span class="lineNum">     105 </span>                :            :   const float small_angle_diff =
<span class="lineNum">     106 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :       common::IDegreeToRadians(params_.angle_resolution_degree);</span>
<span class="lineNum">     107 </span>                :<span class="lineCov">         29 :   float center_2d[2] = {0};</span>
<span class="lineNum">     108 </span>                :            :   bool success =
<span class="lineNum">     109 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :       SolveCenterFromNearestVerticalEdge(bbox, hwl, *ry, center, center_2d);</span>
<span class="lineNum">     110 </span>                :<span class="lineCov">         29 :   float min_x = static_cast&lt;float&gt;(params_.boundary_len);</span>
<span class="lineNum">     111 </span>                :<span class="lineCov">         29 :   float min_y = static_cast&lt;float&gt;(params_.boundary_len);</span>
<span class="lineNum">     112 </span>                :<span class="lineCov">         29 :   float max_x = static_cast&lt;float&gt;(width_ - params_.boundary_len);</span>
<span class="lineNum">     113 </span>                :<span class="lineCov">         29 :   float max_y = static_cast&lt;float&gt;(height_ - params_.boundary_len);</span>
<span class="lineNum">     114 </span>[<span class="branchCov" title="Branch 0 was taken 12 times"> + </span><span class="branchCov" title="Branch 1 was taken 17 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 12 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         29 :   bool truncated = bbox[0] &lt;= min_x || bbox[2] &gt;= max_x || bbox[1] &lt;= min_y ||</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 4 was taken 11 times"> + </span><span class="branchCov" title="Branch 5 was taken 1 time"> + </span>][<span class="branchNoCov" title="Branch 6 was not taken"> - </span><span class="branchCov" title="Branch 7 was taken 11 times"> + </span>]
<span class="lineNum">     115 </span>                :<span class="lineCov">         40 :                    bbox[3] &gt;= max_y;</span>
<span class="lineNum">     116 </span>[<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         29 :   float dist_rough = sqrtf(common::ISqr(center[0]) + common::ISqr(center[2]));</span>
<span class="lineNum">     117 </span>[<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 26 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         29 :   bool ry_pred_is_not_reliable = dist_rough &gt; params_.dist_far &amp;&amp;</span>
<span class="lineNum">     118 </span>                :<span class="lineCov">         32 :                                  bbox[3] - bbox[1] &lt; params_.small_bbox_height;</span>
<span class="lineNum">     119 </span>[<span class="branchCov" title="Branch 0 was taken 26 times"> + </span><span class="branchCov" title="Branch 1 was taken 3 times"> + </span>][<span class="branchCov" title="Branch 3 was taken 26 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         54 :   if (ry_pred_is_not_reliable || std::abs(*ry - PI_HALF) &lt; small_angle_diff ||</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 5 was taken 25 times"> + </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span>][<span class="branchCov" title="Branch 7 was taken 4 times"> + </span><span class="branchCov" title="Branch 8 was taken 21 times"> + </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 9 was taken 8 times"> + </span><span class="branchCov" title="Branch 10 was taken 21 times"> + </span>]
<span class="lineNum">     120 </span>        [<span class="branchCov" title="Branch 1 was taken 25 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         25 :       std::abs(*ry + PI_HALF) &lt; small_angle_diff) {</span>
<span class="lineNum">     121 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 6 times"> + </span>]:<span class="lineCov">          8 :     *ry = *ry &gt; 0.0f ? PI_HALF : -PI_HALF;</span>
<span class="lineNum">     122 </span>                :            :   }
<span class="lineNum">     123 </span>        [<span class="branchCov" title="Branch 0 was taken 11 times"> + </span><span class="branchCov" title="Branch 1 was taken 18 times"> + </span>]:<span class="lineCov">         29 :   if (!truncated) {</span>
<span class="lineNum">     124 </span>        [<span class="branchCov" title="Branch 1 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         11 :     PostRefineOrientation(bbox, hwl, center, ry);</span>
<span class="lineNum">     125 </span>                :            :     success =
<span class="lineNum">     126 </span>        [<span class="branchCov" title="Branch 1 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         11 :         SolveCenterFromNearestVerticalEdge(bbox, hwl, *ry, center, center_2d);</span>
<span class="lineNum">     127 </span>        [<span class="branchCov" title="Branch 1 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         11 :     PostRefineZ(bbox, hwl, center_2d, *ry, center);</span>
<span class="lineNum">     128 </span>                :            :   } else {
<span class="lineNum">     129 </span>        [<span class="branchCov" title="Branch 1 was taken 18 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         18 :     FillRyScoreSingleBin(*ry);</span>
<span class="lineNum">     130 </span>                :            :   }
<span class="lineNum">     131 </span>                :            :   
<span class="lineNum">     132 </span>[<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         29 :   AINFO&lt;&lt;&quot;(DMCZP) (return) LeaveMethod: ObjMapper::Solve3dBboxGivenOneFullBboxDimensionOrientation&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<span class="lineNum">     133 </span>[<span class="branchCov" title="Branch 0 was taken 15 times"> + </span><span class="branchCov" title="Branch 1 was taken 14 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 12 times"> + </span><span class="branchCov" title="Branch 3 was taken 3 times"> + </span>]:<span class="lineCov">         44 :   return success &amp;&amp;</span>
<span class="lineNum">     134 </span>        [<span class="branchCov" title="Branch 1 was taken 15 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         44 :          GetProjectionScore(*ry, bbox, hwl, center, true) &gt; params_.iou_suc;</span>
<a name="135"><span class="lineNum">     135 </span>                :            :  }</a>
<span class="lineNum">     136 </span>                :            : 
<span class="lineNum">     137 </span>                :<span class="lineCov">         29 : bool ObjMapper::Solve3dBbox(const ObjMapperOptions &amp;options, float center[3],</span>
<span class="lineNum">     138 </span>                :            :                             float hwl[3], float *ry) {
<span class="lineNum">     139 </span>[<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         29 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: ObjMapper::Solve3dBbox&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<span class="lineNum">     140 </span>                :            : 
<span class="lineNum">     141 </span>                :            :   // set default value for variance
<span class="lineNum">     142 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :   set_default_variance();</span>
<span class="lineNum">     143 </span>                :<span class="lineCov">         29 :   float var_yaw = 0.0f;</span>
<span class="lineNum">     144 </span>                :<span class="lineCov">         29 :   float var_z = 0.0f;</span>
<span class="lineNum">     145 </span>                :            : 
<span class="lineNum">     146 </span>                :            :   // get input from options
<span class="lineNum">     147 </span>                :<span class="lineCov">         29 :   memcpy(hwl, options.hwl, sizeof(float) * 3);</span>
<span class="lineNum">     148 </span>                :<span class="lineCov">         29 :   float bbox[4] = {0};</span>
<span class="lineNum">     149 </span>                :<span class="lineCov">         29 :   memcpy(bbox, options.bbox, sizeof(float) * 4);</span>
<span class="lineNum">     150 </span>                :<span class="lineCov">         29 :   *ry = options.ry;</span>
<span class="lineNum">     151 </span>                :<span class="lineCov">         29 :   bool check_dimension = options.check_dimension;</span>
<span class="lineNum">     152 </span>                :<span class="lineCov">         29 :   int type_min_vol_index = options.type_min_vol_index;</span>
<span class="lineNum">     153 </span>                :            : 
<span class="lineNum">     154 </span>                :            :   // check input hwl insanity
<span class="lineNum">     155 </span>[<span class="branchCov" title="Branch 0 was taken 14 times"> + </span><span class="branchCov" title="Branch 1 was taken 15 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 14 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         29 :   if (options.is_veh &amp;&amp; check_dimension) {</span>
<span class="lineNum">     156 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 14 times"> + </span>]:<span class="lineCov">         14 :     assert(type_min_vol_index &gt;= 0);</span>
<span class="lineNum">     157 </span>        [<span class="branchCov" title="Branch 1 was taken 14 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         14 :     const std::vector&lt;float&gt; &amp;kVehHwl = object_template_manager_-&gt;VehHwl();</span>
<span class="lineNum">     158 </span>        [<span class="branchCov" title="Branch 1 was taken 14 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         14 :     const float *tmplt_with_min_vol = &amp;kVehHwl[type_min_vol_index];</span>
<span class="lineNum">     159 </span>                :            :     float min_tmplt_vol =
<span class="lineNum">     160 </span>                :<span class="lineCov">         14 :         tmplt_with_min_vol[0] * tmplt_with_min_vol[1] * tmplt_with_min_vol[2];</span>
<span class="lineNum">     161 </span>        [<span class="branchCov" title="Branch 1 was taken 14 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         14 :     float shrink_ratio_vol = common::ISqr(sqrtf(params_.iou_high));</span>
<span class="lineNum">     162 </span>                :<span class="lineCov">         14 :     shrink_ratio_vol *= shrink_ratio_vol;</span>
<span class="lineNum">     163 </span>                :            :     // float shrink_ratio_vol = sqrt(params_.iou_high);
<span class="lineNum">     164 </span>[<span class="branchCov" title="Branch 0 was taken 11 times"> + </span><span class="branchCov" title="Branch 1 was taken 3 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchCov" title="Branch 3 was taken 8 times"> + </span>]:<span class="lineCov">         14 :     if (hwl[0] &lt; params_.abnormal_h_veh ||</span>
<span class="lineNum">     165 </span>                :<span class="lineCov">         11 :         hwl[0] * hwl[1] * hwl[2] &lt; min_tmplt_vol * shrink_ratio_vol) {</span>
<span class="lineNum">     166 </span>                :<span class="lineCov">          6 :       memcpy(hwl, tmplt_with_min_vol, sizeof(float) * 3);</span>
<span class="lineNum">     167 </span>                :            :     } else {
<span class="lineNum">     168 </span>                :<span class="lineCov">          8 :       float hwl_tmplt[3] = {hwl[0], hwl[1], hwl[2]};</span>
<span class="lineNum">     169 </span>                :<span class="lineCov">          8 :       int tmplt_index = -1;</span>
<span class="lineNum">     170 </span>                :            :       float score = object_template_manager_-&gt;VehObjHwlBySearchTemplates(
<span class="lineNum">     171 </span>        [<span class="branchCov" title="Branch 1 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          8 :           hwl_tmplt, &amp;tmplt_index);</span>
<span class="lineNum">     172 </span>                :<span class="lineCov">          8 :       float thres_min_score = shrink_ratio_vol;</span>
<span class="lineNum">     173 </span>                :            : 
<span class="lineNum">     174 </span>        [<span class="branchCov" title="Branch 1 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          8 :       const int kNrDimPerTmplt = object_template_manager_-&gt;NrDimPerTmplt();</span>
<span class="lineNum">     175 </span>                :<span class="lineCov">          8 :       bool search_success = score &gt; thres_min_score;</span>
<span class="lineNum">     176 </span>                :<span class="lineCov">          8 :       bool is_same_type = (type_min_vol_index / kNrDimPerTmplt) == tmplt_index;</span>
<span class="lineNum">     177 </span>                :            :       const std::map&lt;TemplateIndex, int&gt; &amp;kLookUpTableMinVolumeIndex =
<span class="lineNum">     178 </span>        [<span class="branchCov" title="Branch 1 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          8 :           object_template_manager_-&gt;LookUpTableMinVolumeIndex();</span>
<span class="lineNum">     179 </span>                :            :       bool is_car_pred =
<span class="lineNum">     180 </span>                :<span class="lineCov">          8 :           type_min_vol_index ==</span>
<span class="lineNum">     181 </span>        [<span class="branchCov" title="Branch 1 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          8 :           kLookUpTableMinVolumeIndex.at(TemplateIndex::CAR_MIN_VOLUME_INDEX);</span>
<span class="lineNum">     182 </span>                :            : 
<span class="lineNum">     183 </span>[<span class="branchCov" title="Branch 0 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 5 times"> + </span><span class="branchCov" title="Branch 3 was taken 3 times"> + </span>]:<span class="lineCov">          8 :       bool hwl_is_reliable = search_success &amp;&amp; is_same_type;</span>
<span class="lineNum">     184 </span>        [<span class="branchCov" title="Branch 0 was taken 5 times"> + </span><span class="branchCov" title="Branch 1 was taken 3 times"> + </span>]:<span class="lineCov">          8 :       if (hwl_is_reliable) {</span>
<span class="lineNum">     185 </span>                :<span class="lineCov">          5 :         memcpy(hwl, hwl_tmplt, sizeof(float) * 3);</span>
<span class="lineNum">     186 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          3 :       } else if (is_car_pred) {</span>
<span class="lineNum">     187 </span>                :            :         const float *tmplt_with_median_vol =
<span class="lineNum">     188 </span>                :<span class="lineCov">          3 :             tmplt_with_min_vol + kNrDimPerTmplt;</span>
<span class="lineNum">     189 </span>                :<span class="lineCov">         14 :         memcpy(hwl, tmplt_with_median_vol, sizeof(float) * 3);</span>
<span class="lineNum">     190 </span>                :            :       }
<span class="lineNum">     191 </span>                :            :     }
<span class="lineNum">     192 </span>                :            :   }
<span class="lineNum">     193 </span>                :            : 
<span class="lineNum">     194 </span>                :            :   // call 3d solver
<span class="lineNum">     195 </span>                :            :   bool success =
<span class="lineNum">     196 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :       Solve3dBboxGivenOneFullBboxDimensionOrientation(bbox, hwl, ry, center);</span>
<span class="lineNum">     197 </span>                :            : 
<span class="lineNum">     198 </span>                :            :   // calculate variance for yaw &amp; z
<span class="lineNum">     199 </span>                :            :   float yaw_score_mean =
<span class="lineNum">     200 </span>        [<span class="branchCov" title="Branch 3 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         29 :       common::IMean(ry_score_.data(), static_cast&lt;int&gt;(ry_score_.size()));</span>
<span class="lineNum">     201 </span>                :<span class="lineCov">         29 :   float yaw_score_sdv = common::ISdv(ry_score_.data(), yaw_score_mean,</span>
<span class="lineNum">     202 </span>        [<span class="branchCov" title="Branch 2 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         58 :                                      static_cast&lt;int&gt;(ry_score_.size()));</span>
<span class="lineNum">     203 </span>[<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         29 :   var_yaw = common::ISqrt(common::IRec(yaw_score_sdv + params_.eps_mapper));</span>
<span class="lineNum">     204 </span>                :            : 
<span class="lineNum">     205 </span>                :<span class="lineCov">         29 :   float z = center[2];</span>
<span class="lineNum">     206 </span>                :<span class="lineCov">         29 :   float rz = z * params_.rz_ratio;</span>
<span class="lineNum">     207 </span>                :<span class="lineCov">         29 :   float nr_bins_z = static_cast&lt;float&gt;(params_.nr_bins_z);</span>
<span class="lineNum">     208 </span>        [<span class="branchCov" title="Branch 2 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         29 :   std::vector&lt;float&gt; buffer(static_cast&lt;size_t&gt;(2 * nr_bins_z), 0);</span>
<span class="lineNum">     209 </span>                :<span class="lineCov">         29 :   float *score_z = buffer.data();</span>
<span class="lineNum">     210 </span>                :<span class="lineCov">         29 :   float dz = 2 * rz / nr_bins_z;</span>
<span class="lineNum">     211 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :   float z_start = std::max(z - rz, params_.depth_min);</span>
<span class="lineNum">     212 </span>                :<span class="lineCov">         29 :   float z_end = z + rz;</span>
<span class="lineNum">     213 </span>                :<span class="lineCov">         29 :   int count_z_test = 0;</span>
<span class="lineNum">     214 </span>        [<span class="branchCov" title="Branch 0 was taken 233 times"> + </span><span class="branchCov" title="Branch 1 was taken 29 times"> + </span>]:<span class="lineCov">        262 :   for (float z_test = z_start; z_test &lt;= z_end; z_test += dz) {</span>
<span class="lineNum">     215 </span>                :<span class="lineCov">        233 :     float center_test[3] = {center[0], center[1], center[2]};</span>
<span class="lineNum">     216 </span>        [<span class="branchCov" title="Branch 1 was taken 233 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        233 :     float sf = z_test * common::IRec(center_test[2]);</span>
<span class="lineNum">     217 </span>        [<span class="branchCov" title="Branch 1 was taken 233 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        233 :     common::IScale3(center_test, sf);</span>
<span class="lineNum">     218 </span>        [<span class="branchCov" title="Branch 1 was taken 233 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        233 :     float score_test = GetProjectionScore(*ry, bbox, hwl, center_test);</span>
<span class="lineNum">     219 </span>                :<span class="lineCov">        233 :     score_z[count_z_test++] = score_test;</span>
<span class="lineNum">     220 </span>                :            :   }
<span class="lineNum">     221 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :   float z_score_mean = common::IMean(score_z, count_z_test);</span>
<span class="lineNum">     222 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :   float z_score_sdv = common::ISdv(score_z, z_score_mean, count_z_test);</span>
<span class="lineNum">     223 </span>[<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         29 :   var_z = common::ISqr(common::IRec(z_score_sdv + params_.eps_mapper));</span>
<span class="lineNum">     224 </span>                :            : 
<span class="lineNum">     225 </span>                :            :   // fill the position_uncertainty_ and orientation_variance_
<span class="lineNum">     226 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :   orientation_variance_(0) = var_yaw;</span>
<span class="lineNum">     227 </span>                :<span class="lineCov">         29 :   float bbox_cx = (bbox[0] + bbox[2]) / 2;</span>
<span class="lineNum">     228 </span>                :<span class="lineCov">         29 :   float focal = (k_mat_[0] + k_mat_[4]) / 2;</span>
<span class="lineNum">     229 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :   float sf_z_to_x = fabsf(bbox_cx - k_mat_[2]) * common::IRec(focal);</span>
<span class="lineNum">     230 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :   float var_x = var_z * common::ISqr(sf_z_to_x);</span>
<span class="lineNum">     231 </span>                :<span class="lineCov">         29 :   float var_xz = sf_z_to_x * var_z;</span>
<span class="lineNum">     232 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :   position_uncertainty_(0, 0) = var_x;</span>
<span class="lineNum">     233 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         29 :   position_uncertainty_(2, 2) = var_z;</span>
<span class="lineNum">     234 </span>[<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         29 :   position_uncertainty_(0, 2) = position_uncertainty_(2, 0) = var_xz;</span>
<span class="lineNum">     235 </span>                :            :   
<span class="lineNum">     236 </span>[<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         29 :   AINFO&lt;&lt;&quot;(DMCZP) (return) LeaveMethod: ObjMapper::Solve3dBbox&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 29 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<span class="lineNum">     237 </span>                :<span class="lineCov">         29 :   return success;</span>
<a name="238"><span class="lineNum">     238 </span>                :            :  }</a>
<span class="lineNum">     239 </span>                :            : 
<span class="lineNum">     240 </span>                :<span class="lineCov">         11 : void ObjMapper::PostRefineOrientation(const float *bbox, const float *hwl,</span>
<span class="lineNum">     241 </span>                :            :                                       const float *center, float *ry) {
<span class="lineNum">     242 </span>[<span class="branchCov" title="Branch 1 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         11 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: ObjMapper::PostRefineOrientation&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<span class="lineNum">     243 </span>                :            : 
<span class="lineNum">     244 </span>                :<span class="lineCov">         11 :   const int kNrBinsRy = static_cast&lt;int&gt;(ry_score_.size());</span>
<span class="lineNum">     245 </span>        [<span class="branchCov" title="Branch 1 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         11 :   const float PI = common::Constant&lt;float&gt;::PI();</span>
<span class="lineNum">     246 </span>                :<span class="lineCov">         11 :   const float PI_HALF = PI * 0.5f;</span>
<span class="lineNum">     247 </span>                :<span class="lineCov">         11 :   const float D_RY = 2 * PI / static_cast&lt;float&gt;(kNrBinsRy);</span>
<span class="lineNum">     248 </span>                :            : 
<span class="lineNum">     249 </span>                :<span class="lineCov">         11 :   float ry_test = -PI;</span>
<span class="lineNum">     250 </span>                :<span class="lineCov">         11 :   float ry_best = -PI;</span>
<span class="lineNum">     251 </span>                :<span class="lineCov">         11 :   float score_best = 0.0f;</span>
<span class="lineNum">     252 </span>        [<span class="branchCov" title="Branch 1 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         11 :   float score_cur = GetProjectionScore(*ry, bbox, hwl, center, true);</span>
<span class="lineNum">     253 </span>                :<span class="lineCov">         11 :   int count_bin = 0;</span>
<span class="lineNum">     254 </span>        [<span class="branchCov" title="Branch 0 was taken 396 times"> + </span><span class="branchCov" title="Branch 1 was taken 11 times"> + </span>]:<span class="lineCov">        407 :   while (ry_test &lt; PI - params_.eps_mapper) {</span>
<span class="lineNum">     255 </span>[<span class="branchCov" title="Branch 1 was taken 396 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 196 times"> + </span><span class="branchCov" title="Branch 4 was taken 200 times"> + </span>]:<span class="lineCov">        396 :     if (CalAngleDiff(ry_test, *ry) &gt; PI_HALF) {</span>
<span class="lineNum">     256 </span>                :<span class="lineCov">        196 :       ry_test += D_RY;</span>
<span class="lineNum">     257 </span>        [<span class="branchCov" title="Branch 1 was taken 196 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        196 :       ry_score_[count_bin++ % kNrBinsRy] = 0.0f;</span>
<span class="lineNum">     258 </span>                :<span class="lineCov">        196 :       continue;</span>
<span class="lineNum">     259 </span>                :            :     }
<span class="lineNum">     260 </span>                :            : 
<span class="lineNum">     261 </span>        [<span class="branchCov" title="Branch 1 was taken 200 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        200 :     float score_test = GetProjectionScore(ry_test, bbox, hwl, center, true);</span>
<span class="lineNum">     262 </span>        [<span class="branchCov" title="Branch 0 was taken 66 times"> + </span><span class="branchCov" title="Branch 1 was taken 134 times"> + </span>]:<span class="lineCov">        200 :     if (score_test &gt; score_best) {</span>
<span class="lineNum">     263 </span>                :<span class="lineCov">         66 :       score_best = score_test;</span>
<span class="lineNum">     264 </span>                :<span class="lineCov">         66 :       ry_best = ry_test;</span>
<span class="lineNum">     265 </span>                :            :     }
<span class="lineNum">     266 </span>                :<span class="lineCov">        200 :     ry_test += D_RY;</span>
<span class="lineNum">     267 </span>        [<span class="branchCov" title="Branch 1 was taken 200 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        200 :     ry_score_[count_bin++ % kNrBinsRy] = score_test;</span>
<span class="lineNum">     268 </span>                :            :   }
<span class="lineNum">     269 </span>        [<span class="branchCov" title="Branch 2 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         11 :   common::IUnitize(ry_score_.data(), kNrBinsRy);</span>
<span class="lineNum">     270 </span>[<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 9 times"> + </span>]:<span class="lineCov">         11 :   if (score_best &gt; params_.iou_high &amp;&amp; score_cur &lt; params_.iou_suc) {</span>
<span class="lineNum">     271 </span>                :<span class="lineNoCov">          0 :     *ry = ry_best;</span>
<span class="lineNum">     272 </span>                :            :   }
<span class="lineNum">     273 </span>                :            : 
<span class="lineNum">     274 </span>                :<span class="lineCov">         11 :   float bbox_res[4] = {0};</span>
<span class="lineNum">     275 </span>                :            :   float score_final =
<span class="lineNum">     276 </span>        [<span class="branchCov" title="Branch 1 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         11 :       GetProjectionScore(*ry, bbox, hwl, center, true, bbox_res);</span>
<span class="lineNum">     277 </span>        [<span class="branchCov" title="Branch 0 was taken 8 times"> + </span><span class="branchCov" title="Branch 1 was taken 3 times"> + </span>]:<span class="lineCov">         11 :   if (score_final &gt; params_.iou_high) {</span>
<span class="lineNum">     278 </span>                :            :     
<span class="lineNum">     279 </span>[<span class="branchCov" title="Branch 1 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          8 :   AINFO&lt;&lt;&quot;(DMCZP) (return) LeaveMethod: ObjMapper::PostRefineOrientation&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<span class="lineNum">     280 </span>                :<span class="lineCov">         11 :   return;</span>
<span class="lineNum">     281 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">          3 :   } else if (bbox[2] - bbox[0] &lt;</span>
<span class="lineNum">     282 </span>                :<span class="lineCov">          3 :              (bbox_res[2] - bbox_res[0]) * params_.factor_small) {</span>
<span class="lineNum">     283 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          1 :     *ry = *ry &gt; 0 ? PI_HALF : -PI_HALF;</span>
<span class="lineNum">     284 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :     FillRyScoreSingleBin(*ry);</span>
<span class="lineNum">     285 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          2 :   } else if ((bbox[2] - bbox[0]) * params_.factor_small &gt;</span>
<span class="lineNum">     286 </span>                :<span class="lineCov">          2 :              bbox_res[2] - bbox_res[0]) {</span>
<span class="lineNum">     287 </span>                :<span class="lineCov">          1 :     *ry = 0.0f;</span>
<span class="lineNum">     288 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :     FillRyScoreSingleBin(*ry);</span>
<span class="lineNum">     289 </span>                :            :   }
<span class="lineNum">     290 </span>                :            : 
<span class="lineNum">     291 </span>[<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          3 :    AINFO&lt;&lt;&quot;(DMCZP) LeaveMethod: ObjMapper::PostRefineOrientation&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<a name="292"><span class="lineNum">     292 </span>                :            :  }</a>
<span class="lineNum">     293 </span>                :            : 
<span class="lineNum">     294 </span>                :<span class="lineCov">         24 : void ObjMapper::GetCenter(const float *bbox, const float &amp;z_ref,</span>
<span class="lineNum">     295 </span>                :            :                           const float &amp;ry, const float *hwl, float *center,
<span class="lineNum">     296 </span>                :            :                           float *x) const {
<span class="lineNum">     297 </span>[<span class="branchCov" title="Branch 1 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         24 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: ObjMapper::GetCenter&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<span class="lineNum">     298 </span>                :            : 
<span class="lineNum">     299 </span>                :<span class="lineCov">         24 :   float x_target[2] = {(bbox[0] + bbox[2]) / 2, (bbox[1] + bbox[3]) / 2};</span>
<span class="lineNum">     300 </span>                :<span class="lineCov">         24 :   const float kMinCost = params_.reproj_err;</span>
<span class="lineNum">     301 </span>                :<span class="lineCov">         24 :   const float EPS_COST_DELTA = params_.eps_mapper;</span>
<span class="lineNum">     302 </span>                :<span class="lineCov">         24 :   const float LR = params_.learning_r;</span>
<span class="lineNum">     303 </span>                :<span class="lineCov">         24 :   const int MAX_ITERATION = params_.max_nr_iter;</span>
<span class="lineNum">     304 </span>                :            : 
<span class="lineNum">     305 </span>                :<span class="lineCov">         24 :   float cost_pre = 2.0f * static_cast&lt;float&gt;(width_);</span>
<span class="lineNum">     306 </span>                :<span class="lineCov">         24 :   float cost_delta = 0.0f;</span>
<span class="lineNum">     307 </span>                :<span class="lineCov">         24 :   float center_test[3] = {0};</span>
<span class="lineNum">     308 </span>                :<span class="lineCov">         24 :   float rot[9] = {0};</span>
<span class="lineNum">     309 </span>        [<span class="branchCov" title="Branch 1 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         24 :   GenRotMatrix(ry, rot);</span>
<span class="lineNum">     310 </span>                :<span class="lineCov">         24 :   int iter = 1;</span>
<span class="lineNum">     311 </span>                :<span class="lineCov">         24 :   bool stop = false;</span>
<span class="lineNum">     312 </span>                :<span class="lineCov">         24 :   float h = hwl[0];</span>
<span class="lineNum">     313 </span>                :<span class="lineCov">         24 :   float w = hwl[1];</span>
<span class="lineNum">     314 </span>                :<span class="lineCov">         24 :   float l = hwl[2];</span>
<span class="lineNum">     315 </span>                :<span class="lineCov">         24 :   float x_corners[8] = {0};</span>
<span class="lineNum">     316 </span>                :<span class="lineCov">         24 :   float y_corners[8] = {0};</span>
<span class="lineNum">     317 </span>                :<span class="lineCov">         24 :   float z_corners[8] = {0};</span>
<span class="lineNum">     318 </span>        [<span class="branchCov" title="Branch 1 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         24 :   GenCorners(h, w, l, x_corners, y_corners, z_corners);</span>
<span class="lineNum">     319 </span>                :            : 
<span class="lineNum">     320 </span>                :<span class="lineCov">         24 :   float x_max_flt = static_cast&lt;float&gt;(width_ - 1);</span>
<span class="lineNum">     321 </span>                :<span class="lineCov">         24 :   float y_max_flt = static_cast&lt;float&gt;(height_ - 1);</span>
<span class="lineNum">     322 </span>                :            : 
<span class="lineNum">     323 </span>                :            :   // std::cout &lt;&lt; &quot;start to iteratively search the center...&quot; &lt;&lt; std::endl;
<span class="lineNum">     324 </span>        [<span class="branchCov" title="Branch 0 was taken 68 times"> + </span><span class="branchCov" title="Branch 1 was taken 24 times"> + </span>]:<span class="lineCov">         92 :   while (!stop) {</span>
<span class="lineNum">     325 </span>        [<span class="branchCov" title="Branch 1 was taken 68 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         68 :     common::IBackprojectCanonical(x, k_mat_, z_ref, center_test);</span>
<span class="lineNum">     326 </span>                :<span class="lineCov">         68 :     center_test[1] += hwl[0] / 2;</span>
<span class="lineNum">     327 </span>                :<span class="lineCov">         68 :     float x_min = FLT_MAX;</span>
<span class="lineNum">     328 </span>                :<span class="lineCov">         68 :     float x_max = -FLT_MAX;</span>
<span class="lineNum">     329 </span>                :<span class="lineCov">         68 :     float y_min = FLT_MAX;</span>
<span class="lineNum">     330 </span>                :<span class="lineCov">         68 :     float y_max = -FLT_MAX;</span>
<span class="lineNum">     331 </span>                :<span class="lineCov">         68 :     float x_proj[3] = {0};</span>
<span class="lineNum">     332 </span>                :            : 
<span class="lineNum">     333 </span>        [<span class="branchCov" title="Branch 0 was taken 544 times"> + </span><span class="branchCov" title="Branch 1 was taken 68 times"> + </span>]:<span class="lineCov">        612 :     for (int i = 0; i &lt; 8; ++i) {</span>
<span class="lineNum">     334 </span>                :            :       // bbox from x_proj
<span class="lineNum">     335 </span>                :<span class="lineCov">        544 :       float x_box[3] = {x_corners[i], y_corners[i], z_corners[i]};</span>
<span class="lineNum">     336 </span>        [<span class="branchCov" title="Branch 1 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        544 :       common::IProjectThroughKRt(k_mat_, rot, center_test, x_box, x_proj);</span>
<span class="lineNum">     337 </span>        [<span class="branchCov" title="Branch 1 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        544 :       x_proj[0] *= common::IRec(x_proj[2]);</span>
<span class="lineNum">     338 </span>        [<span class="branchCov" title="Branch 1 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        544 :       x_proj[1] *= common::IRec(x_proj[2]);</span>
<span class="lineNum">     339 </span>        [<span class="branchCov" title="Branch 1 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        544 :       x_min = std::min(x_min, x_proj[0]);</span>
<span class="lineNum">     340 </span>        [<span class="branchCov" title="Branch 1 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        544 :       x_max = std::max(x_max, x_proj[0]);</span>
<span class="lineNum">     341 </span>        [<span class="branchCov" title="Branch 1 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        544 :       y_min = std::min(y_min, x_proj[1]);</span>
<span class="lineNum">     342 </span>        [<span class="branchCov" title="Branch 1 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        544 :       y_max = std::max(y_max, x_proj[1]);</span>
<span class="lineNum">     343 </span>                :            : 
<span class="lineNum">     344 </span>                :            :       // truncation processing
<span class="lineNum">     345 </span>[<span class="branchCov" title="Branch 1 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">        544 :       x_min = std::min(std::max(x_min, 0.0f), x_max_flt);</span>
<span class="lineNum">     346 </span>[<span class="branchCov" title="Branch 1 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">        544 :       x_max = std::min(std::max(x_max, 0.0f), x_max_flt);</span>
<span class="lineNum">     347 </span>[<span class="branchCov" title="Branch 1 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">        544 :       y_min = std::min(std::max(y_min, 0.0f), y_max_flt);</span>
<span class="lineNum">     348 </span>[<span class="branchCov" title="Branch 1 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 544 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">        544 :       y_max = std::min(std::max(y_max, 0.0f), y_max_flt);</span>
<span class="lineNum">     349 </span>                :            :     }
<span class="lineNum">     350 </span>                :<span class="lineCov">         68 :     float x_cur[2] = {(x_min + x_max) / 2, (y_min + y_max) / 2};</span>
<span class="lineNum">     351 </span>        [<span class="branchCov" title="Branch 1 was taken 68 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         68 :     float cost_cur = common::ISqrt(common::ISqr(x_cur[0] - x_target[0]) +</span>
<span class="lineNum">     352 </span>[<span class="branchCov" title="Branch 1 was taken 68 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 68 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         68 :                                    common::ISqr(x_cur[1] - x_target[1]));</span>
<span class="lineNum">     353 </span>                :            : 
<span class="lineNum">     354 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 68 times"> + </span>]:<span class="lineCov">         68 :     if (cost_cur &gt;= cost_pre) {</span>
<span class="lineNum">     355 </span>                :<span class="lineNoCov">          0 :       stop = true;</span>
<span class="lineNum">     356 </span>                :            :     } else {
<span class="lineNum">     357 </span>                :<span class="lineCov">         68 :       memcpy(center, center_test, sizeof(float) * 3);</span>
<span class="lineNum">     358 </span>                :<span class="lineCov">         68 :       cost_delta = (cost_pre - cost_cur) / cost_pre;</span>
<span class="lineNum">     359 </span>                :<span class="lineCov">         68 :       cost_pre = cost_cur;</span>
<span class="lineNum">     360 </span>                :<span class="lineCov">         68 :       x[0] += (x_target[0] - x_cur[0]) * LR;</span>
<span class="lineNum">     361 </span>                :<span class="lineCov">         68 :       x[1] += (x_target[1] - x_cur[1]) * LR;</span>
<span class="lineNum">     362 </span>                :<span class="lineCov">         68 :       ++iter;</span>
<span class="lineNum">     363 </span>[<span class="branchCov" title="Branch 0 was taken 66 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 66 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         68 :       stop = iter &gt;= MAX_ITERATION || cost_delta &lt; EPS_COST_DELTA ||</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 22 times"> + </span><span class="branchCov" title="Branch 5 was taken 44 times"> + </span>]
<span class="lineNum">     364 </span>                :<span class="lineCov">         68 :              cost_pre &lt; kMinCost;</span>
<span class="lineNum">     365 </span>                :            :     }
<span class="lineNum">     366 </span>                :            :   }
<span class="lineNum">     367 </span>                :            : 
<span class="lineNum">     368 </span>[<span class="branchCov" title="Branch 1 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         24 :    AINFO&lt;&lt;&quot;(DMCZP) LeaveMethod: ObjMapper::GetCenter&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<span class="lineNum">     369 </span>                :<span class="lineCov">         24 :  }</span>
<span class="lineNum">     370 </span>                :            : 
<a name="371"><span class="lineNum">     371 </span>                :            : }  // namespace camera</a>
<span class="lineNum">     372 </span>                :            : }  // namespace perception
<span class="lineNum">     373 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          4 : }  // namespace apollo</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
