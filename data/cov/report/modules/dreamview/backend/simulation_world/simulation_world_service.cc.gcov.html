<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - stripped_conv.info - modules/dreamview/backend/simulation_world/simulation_world_service.cc</title>
  <link rel="stylesheet" type="text/css" href="../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../index.html">top level</a> - <a href="index.html">modules/dreamview/backend/simulation_world</a> - simulation_world_service.cc<span style="font-size: 80%;"> (source / <a href="simulation_world_service.cc.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">stripped_conv.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">405</td>
            <td class="headerCovTableEntry">815</td>
            <td class="headerCovTableEntryLo">49.7 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2020-05-21 16:34:32</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">28</td>
            <td class="headerCovTableEntry">55</td>
            <td class="headerCovTableEntryLo">50.9 %</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">628</td>
            <td class="headerCovTableEntry">2407</td>
            <td class="headerCovTableEntryLo">26.1 %</td>
          </tr>
          <tr><td><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : #include &quot;cyber/common/log.h&quot;</a>
<span class="lineNum">       2 </span>                :            : /******************************************************************************
<span class="lineNum">       3 </span>                :            :  * Copyright 2017 The Apollo Authors. All Rights Reserved.
<span class="lineNum">       4 </span>                :            :  *
<span class="lineNum">       5 </span>                :            :  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<span class="lineNum">       6 </span>                :            :  * you may not use this file except in compliance with the License.
<span class="lineNum">       7 </span>                :            :  * You may obtain a copy of the License at
<span class="lineNum">       8 </span>                :            :  *
<span class="lineNum">       9 </span>                :            :  * http://www.apache.org/licenses/LICENSE-2.0
<span class="lineNum">      10 </span>                :            :  *
<span class="lineNum">      11 </span>                :            :  * Unless required by applicable law or agreed to in writing, software
<span class="lineNum">      12 </span>                :            :  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<span class="lineNum">      13 </span>                :            :  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class="lineNum">      14 </span>                :            :  * See the License for the specific language governing permissions and
<span class="lineNum">      15 </span>                :            :  * limitations under the License.
<span class="lineNum">      16 </span>                :            :  *****************************************************************************/
<span class="lineNum">      17 </span>                :            : 
<span class="lineNum">      18 </span>                :            : #include &quot;modules/dreamview/backend/simulation_world/simulation_world_service.h&quot;
<span class="lineNum">      19 </span>                :            : 
<span class="lineNum">      20 </span>                :            : #include &lt;unordered_set&gt;
<span class="lineNum">      21 </span>                :            : 
<span class="lineNum">      22 </span>                :            : #include &quot;absl/strings/str_split.h&quot;
<span class="lineNum">      23 </span>                :            : #include &quot;cyber/common/file.h&quot;
<span class="lineNum">      24 </span>                :            : #include &quot;google/protobuf/util/json_util.h&quot;
<span class="lineNum">      25 </span>                :            : #include &quot;modules/canbus/proto/chassis.pb.h&quot;
<span class="lineNum">      26 </span>                :            : #include &quot;modules/common/adapters/adapter_gflags.h&quot;
<span class="lineNum">      27 </span>                :            : #include &quot;modules/common/configs/vehicle_config_helper.h&quot;
<span class="lineNum">      28 </span>                :            : #include &quot;modules/common/math/quaternion.h&quot;
<span class="lineNum">      29 </span>                :            : #include &quot;modules/common/proto/geometry.pb.h&quot;
<span class="lineNum">      30 </span>                :            : #include &quot;modules/common/proto/vehicle_signal.pb.h&quot;
<span class="lineNum">      31 </span>                :            : #include &quot;modules/common/time/time.h&quot;
<span class="lineNum">      32 </span>                :            : #include &quot;modules/common/util/map_util.h&quot;
<span class="lineNum">      33 </span>                :            : #include &quot;modules/common/util/points_downsampler.h&quot;
<span class="lineNum">      34 </span>                :            : #include &quot;modules/common/util/util.h&quot;
<span class="lineNum">      35 </span>                :            : 
<span class="lineNum">      36 </span>                :            : #include &quot;modules/dreamview/backend/common/dreamview_gflags.h&quot;
<span class="lineNum">      37 </span>                :            : #include &quot;modules/dreamview/proto/simulation_world.pb.h&quot;
<span class="lineNum">      38 </span>                :            : 
<span class="lineNum">      39 </span>                :            : namespace apollo {
<span class="lineNum">      40 </span>                :            : namespace dreamview {
<span class="lineNum">      41 </span>                :            : 
<span class="lineNum">      42 </span>                :            : using apollo::canbus::Chassis;
<span class="lineNum">      43 </span>                :            : using apollo::common::DriveEvent;
<span class="lineNum">      44 </span>                :            : using apollo::common::PathPoint;
<span class="lineNum">      45 </span>                :            : using apollo::common::Point3D;
<span class="lineNum">      46 </span>                :            : using apollo::common::PointENU;
<span class="lineNum">      47 </span>                :            : using apollo::common::TrajectoryPoint;
<span class="lineNum">      48 </span>                :            : using apollo::common::VehicleConfigHelper;
<span class="lineNum">      49 </span>                :            : using apollo::common::monitor::MonitorMessage;
<span class="lineNum">      50 </span>                :            : using apollo::common::monitor::MonitorMessageItem;
<span class="lineNum">      51 </span>                :            : using apollo::common::time::Clock;
<span class="lineNum">      52 </span>                :            : using apollo::common::util::DownsampleByAngle;
<span class="lineNum">      53 </span>                :            : using apollo::common::util::FillHeader;
<span class="lineNum">      54 </span>                :            : using apollo::control::ControlCommand;
<span class="lineNum">      55 </span>                :            : using apollo::cyber::common::GetProtoFromFile;
<span class="lineNum">      56 </span>                :            : using apollo::hdmap::Curve;
<span class="lineNum">      57 </span>                :            : using apollo::hdmap::Map;
<span class="lineNum">      58 </span>                :            : using apollo::hdmap::Path;
<span class="lineNum">      59 </span>                :            : using apollo::localization::Gps;
<span class="lineNum">      60 </span>                :            : using apollo::localization::LocalizationEstimate;
<span class="lineNum">      61 </span>                :            : using apollo::perception::PerceptionObstacle;
<span class="lineNum">      62 </span>                :            : using apollo::perception::PerceptionObstacles;
<span class="lineNum">      63 </span>                :            : using apollo::perception::TrafficLight;
<span class="lineNum">      64 </span>                :            : using apollo::perception::TrafficLightDetection;
<span class="lineNum">      65 </span>                :            : using apollo::planning::ADCTrajectory;
<span class="lineNum">      66 </span>                :            : using apollo::planning::DecisionResult;
<span class="lineNum">      67 </span>                :            : using apollo::planning::StopReasonCode;
<span class="lineNum">      68 </span>                :            : using apollo::planning_internal::PlanningData;
<span class="lineNum">      69 </span>                :            : using apollo::prediction::ObstaclePriority;
<span class="lineNum">      70 </span>                :            : using apollo::prediction::PredictionObstacle;
<span class="lineNum">      71 </span>                :            : using apollo::prediction::PredictionObstacles;
<span class="lineNum">      72 </span>                :            : using apollo::relative_map::MapMsg;
<span class="lineNum">      73 </span>                :            : using apollo::relative_map::NavigationInfo;
<span class="lineNum">      74 </span>                :            : using apollo::routing::RoutingRequest;
<span class="lineNum">      75 </span>                :            : using apollo::routing::RoutingResponse;
<span class="lineNum">      76 </span>                :            : using apollo::storytelling::Stories;
<span class="lineNum">      77 </span>                :            : 
<span class="lineNum">      78 </span>                :            : using Json = nlohmann::json;
<span class="lineNum">      79 </span>                :            : using ::google::protobuf::util::MessageToJsonString;
<span class="lineNum">      80 </span>                :            : 
<span class="lineNum">      81 </span>                :            : // Angle threshold is about 5.72 degree.
<span class="lineNum">      82 </span>                :            : static constexpr double kAngleThreshold = 0.1;
<span class="lineNum">      83 </span>                :            : 
<a name="84"><span class="lineNum">      84 </span>                :            : namespace {</a>
<span class="lineNum">      85 </span>                :            : 
<span class="lineNum">      86 </span>                :<span class="lineCov">          1 : double CalculateAcceleration(</span>
<span class="lineNum">      87 </span>                :            :     const Point3D &amp;acceleration, const Point3D &amp;velocity,
<span class="lineNum">      88 </span>                :            :     const apollo::canbus::Chassis_GearPosition &amp;gear_location) {
<span class="lineNum">      89 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: CalculateAcceleration&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">      90 </span>                :            : 
<span class="lineNum">      91 </span>                :            :   // Calculates the dot product of acceleration and velocity. The sign
<span class="lineNum">      92 </span>                :            :   // of this projection indicates whether this is acceleration or
<span class="lineNum">      93 </span>                :            :   // deceleration.
<span class="lineNum">      94 </span>                :            :   double projection =
<span class="lineNum">      95 </span>                :<span class="lineCov">          1 :       acceleration.x() * velocity.x() + acceleration.y() * velocity.y();</span>
<span class="lineNum">      96 </span>                :            : 
<span class="lineNum">      97 </span>                :            :   // Calculates the magnitude of the acceleration. Negate the value if
<span class="lineNum">      98 </span>                :            :   // it is indeed a deceleration.
<span class="lineNum">      99 </span>                :<span class="lineCov">          1 :   double magnitude = std::hypot(acceleration.x(), acceleration.y());</span>
<span class="lineNum">     100 </span>        [<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (std::signbit(projection)) {</span>
<span class="lineNum">     101 </span>                :<span class="lineNoCov">          0 :     magnitude = -magnitude;</span>
<span class="lineNum">     102 </span>                :            :   }
<span class="lineNum">     103 </span>                :            : 
<span class="lineNum">     104 </span>                :            :   // Negate the value if gear is reverse
<span class="lineNum">     105 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (gear_location == Chassis::GEAR_REVERSE) {</span>
<span class="lineNum">     106 </span>                :<span class="lineNoCov">          0 :     magnitude = -magnitude;</span>
<span class="lineNum">     107 </span>                :            :   }
<span class="lineNum">     108 </span>                :            : 
<span class="lineNum">     109 </span>                :<span class="lineCov">          1 :   return magnitude;</span>
<a name="110"><span class="lineNum">     110 </span>                :            : }</a>
<span class="lineNum">     111 </span>                :            : 
<span class="lineNum">     112 </span>                :<span class="lineCov">          1 : Object::DisengageType DeduceDisengageType(const Chassis &amp;chassis) {</span>
<span class="lineNum">     113 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: DeduceDisengageType&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     114 </span>                :            : 
<span class="lineNum">     115 </span>        [<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (chassis.error_code() != Chassis::NO_ERROR) {</span>
<span class="lineNum">     116 </span>                :<span class="lineNoCov">          0 :     return Object::DISENGAGE_CHASSIS_ERROR;</span>
<span class="lineNum">     117 </span>                :            :   }
<span class="lineNum">     118 </span>                :            : 
<span class="lineNum">     119 </span>  [<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span> :<span class="lineCov">          1 :   switch (chassis.driving_mode()) {</span>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]
<span class="lineNum">     120 </span>                :            :     case Chassis::COMPLETE_AUTO_DRIVE:
<span class="lineNum">     121 </span>                :<span class="lineNoCov">          0 :       return Object::DISENGAGE_NONE;</span>
<span class="lineNum">     122 </span>                :            :     case Chassis::COMPLETE_MANUAL:
<span class="lineNum">     123 </span>                :<span class="lineCov">          1 :       return Object::DISENGAGE_MANUAL;</span>
<span class="lineNum">     124 </span>                :            :     case Chassis::AUTO_STEER_ONLY:
<span class="lineNum">     125 </span>                :<span class="lineNoCov">          0 :       return Object::DISENGAGE_AUTO_STEER_ONLY;</span>
<span class="lineNum">     126 </span>                :            :     case Chassis::AUTO_SPEED_ONLY:
<span class="lineNum">     127 </span>                :<span class="lineNoCov">          0 :       return Object::DISENGAGE_AUTO_SPEED_ONLY;</span>
<span class="lineNum">     128 </span>                :            :     case Chassis::EMERGENCY_MODE:
<span class="lineNum">     129 </span>                :<span class="lineNoCov">          0 :       return Object::DISENGAGE_EMERGENCY;</span>
<span class="lineNum">     130 </span>                :            :     default:
<span class="lineNum">     131 </span>                :<span class="lineCov">          1 :       return Object::DISENGAGE_UNKNOWN;</span>
<span class="lineNum">     132 </span>                :            :   }
<a name="133"><span class="lineNum">     133 </span>                :            : }</a>
<span class="lineNum">     134 </span>                :            : 
<span class="lineNum">     135 </span>                :<span class="lineCov">          5 : void SetObstacleType(const PerceptionObstacle &amp;obstacle, Object *world_object) {</span>
<span class="lineNum">     136 </span>[<span class="branchCov" title="Branch 2 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          5 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SetObstacleType&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     137 </span>                :            : 
<span class="lineNum">     138 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 5 times"> + </span>]:<span class="lineCov">          5 :   if (world_object == nullptr) {</span>
<span class="lineNum">     139 </span>                :<span class="lineCov">          5 :     return;</span>
<span class="lineNum">     140 </span>                :            :   }
<span class="lineNum">     141 </span>                :            : 
<span class="lineNum">     142 </span>  [<span class="branchCov" title="Branch 1 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span> :<span class="lineCov">          5 :   switch (obstacle.type()) {</span>
<span class="lineNum">         </span>      <span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<span class="lineNum">     143 </span>                :            :     case PerceptionObstacle::UNKNOWN:
<span class="lineNum">     144 </span>                :<span class="lineCov">          4 :       world_object-&gt;set_type(Object_Type_UNKNOWN);</span>
<span class="lineNum">     145 </span>                :<span class="lineCov">          4 :       break;</span>
<span class="lineNum">     146 </span>                :            :     case PerceptionObstacle::UNKNOWN_MOVABLE:
<span class="lineNum">     147 </span>                :<span class="lineNoCov">          0 :       world_object-&gt;set_type(Object_Type_UNKNOWN_MOVABLE);</span>
<span class="lineNum">     148 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     149 </span>                :            :     case PerceptionObstacle::UNKNOWN_UNMOVABLE:
<span class="lineNum">     150 </span>                :<span class="lineNoCov">          0 :       world_object-&gt;set_type(Object_Type_UNKNOWN_UNMOVABLE);</span>
<span class="lineNum">     151 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     152 </span>                :            :     case PerceptionObstacle::PEDESTRIAN:
<span class="lineNum">     153 </span>                :<span class="lineNoCov">          0 :       world_object-&gt;set_type(Object_Type_PEDESTRIAN);</span>
<span class="lineNum">     154 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     155 </span>                :            :     case PerceptionObstacle::BICYCLE:
<span class="lineNum">     156 </span>                :<span class="lineNoCov">          0 :       world_object-&gt;set_type(Object_Type_BICYCLE);</span>
<span class="lineNum">     157 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     158 </span>                :            :     case PerceptionObstacle::VEHICLE:
<span class="lineNum">     159 </span>                :<span class="lineCov">          1 :       world_object-&gt;set_type(Object_Type_VEHICLE);</span>
<span class="lineNum">     160 </span>                :<span class="lineCov">          1 :       break;</span>
<span class="lineNum">     161 </span>                :            :     default:
<span class="lineNum">     162 </span>                :<span class="lineNoCov">          0 :       world_object-&gt;set_type(Object_Type_VIRTUAL);</span>
<span class="lineNum">     163 </span>                :            :   }
<span class="lineNum">     164 </span>                :            : 
<span class="lineNum">     165 </span>                :<span class="lineCov">          5 :   world_object-&gt;set_sub_type(obstacle.sub_type());</span>
<a name="166"><span class="lineNum">     166 </span>                :            : }</a>
<span class="lineNum">     167 </span>                :            : 
<span class="lineNum">     168 </span>                :<span class="lineCov">          1 : void SetStopReason(const StopReasonCode &amp;reason_code, Decision *decision) {</span>
<span class="lineNum">     169 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SetStopReason&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     170 </span>                :            : 
<span class="lineNum">     171 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          1 :   switch (reason_code) {</span>
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 1 time"> + </span> 
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>]
<span class="lineNum">     172 </span>                :            :     case StopReasonCode::STOP_REASON_HEAD_VEHICLE:
<span class="lineNum">     173 </span>                :<span class="lineNoCov">          0 :       decision-&gt;set_stopreason(Decision::STOP_REASON_HEAD_VEHICLE);</span>
<span class="lineNum">     174 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     175 </span>                :            :     case StopReasonCode::STOP_REASON_DESTINATION:
<span class="lineNum">     176 </span>                :<span class="lineNoCov">          0 :       decision-&gt;set_stopreason(Decision::STOP_REASON_DESTINATION);</span>
<span class="lineNum">     177 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     178 </span>                :            :     case StopReasonCode::STOP_REASON_PEDESTRIAN:
<span class="lineNum">     179 </span>                :<span class="lineNoCov">          0 :       decision-&gt;set_stopreason(Decision::STOP_REASON_PEDESTRIAN);</span>
<span class="lineNum">     180 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     181 </span>                :            :     case StopReasonCode::STOP_REASON_OBSTACLE:
<span class="lineNum">     182 </span>                :<span class="lineNoCov">          0 :       decision-&gt;set_stopreason(Decision::STOP_REASON_OBSTACLE);</span>
<span class="lineNum">     183 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     184 </span>                :            :     case StopReasonCode::STOP_REASON_SIGNAL:
<span class="lineNum">     185 </span>                :<span class="lineNoCov">          0 :       decision-&gt;set_stopreason(Decision::STOP_REASON_SIGNAL);</span>
<span class="lineNum">     186 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     187 </span>                :            :     case StopReasonCode::STOP_REASON_STOP_SIGN:
<span class="lineNum">     188 </span>                :<span class="lineNoCov">          0 :       decision-&gt;set_stopreason(Decision::STOP_REASON_STOP_SIGN);</span>
<span class="lineNum">     189 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     190 </span>                :            :     case StopReasonCode::STOP_REASON_YIELD_SIGN:
<span class="lineNum">     191 </span>                :<span class="lineNoCov">          0 :       decision-&gt;set_stopreason(Decision::STOP_REASON_YIELD_SIGN);</span>
<span class="lineNum">     192 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     193 </span>                :            :     case StopReasonCode::STOP_REASON_CLEAR_ZONE:
<span class="lineNum">     194 </span>                :<span class="lineNoCov">          0 :       decision-&gt;set_stopreason(Decision::STOP_REASON_CLEAR_ZONE);</span>
<span class="lineNum">     195 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     196 </span>                :            :     case StopReasonCode::STOP_REASON_CROSSWALK:
<span class="lineNum">     197 </span>                :<span class="lineCov">          1 :       decision-&gt;set_stopreason(Decision::STOP_REASON_CROSSWALK);</span>
<span class="lineNum">     198 </span>                :<span class="lineCov">          1 :       break;</span>
<span class="lineNum">     199 </span>                :            :     case StopReasonCode::STOP_REASON_PULL_OVER:
<span class="lineNum">     200 </span>                :<span class="lineNoCov">          0 :       decision-&gt;set_stopreason(Decision::STOP_REASON_PULL_OVER);</span>
<span class="lineNum">     201 </span>                :<span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     202 </span>                :            :     default:
<span class="lineNum">     203 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :       AWARN &lt;&lt; &quot;Unrecognizable stop reason code:&quot; &lt;&lt; reason_code;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>][<span class="branchNoExec" title="Branch 17 was not executed"> # </span><span class="branchNoExec" title="Branch 18 was not executed"> # </span>]
<span class="lineNum">     204 </span>                :            :   }
<a name="205"><span class="lineNum">     205 </span>                :<span class="lineCov">          1 : }</span></a>
<span class="lineNum">     206 </span>                :            : 
<span class="lineNum">     207 </span>                :<span class="lineCov">          2 : void UpdateTurnSignal(const apollo::common::VehicleSignal &amp;signal,</span>
<span class="lineNum">     208 </span>                :            :                       Object *auto_driving_car) {
<span class="lineNum">     209 </span>[<span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          2 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: UpdateTurnSignal&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     210 </span>                :            : 
<span class="lineNum">     211 </span>        [<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span>]:<span class="lineCov">          2 :   if (signal.turn_signal() == apollo::common::VehicleSignal::TURN_LEFT) {</span>
<span class="lineNum">     212 </span>                :<span class="lineNoCov">          0 :     auto_driving_car-&gt;set_current_signal(&quot;LEFT&quot;);</span>
<span class="lineNum">     213 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :   } else if (signal.turn_signal() ==</span>
<span class="lineNum">     214 </span>                :            :              apollo::common::VehicleSignal::TURN_RIGHT) {
<span class="lineNum">     215 </span>                :<span class="lineCov">          2 :     auto_driving_car-&gt;set_current_signal(&quot;RIGHT&quot;);</span>
<span class="lineNum">     216 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   } else if (signal.emergency_light()) {</span>
<span class="lineNum">     217 </span>                :<span class="lineNoCov">          0 :     auto_driving_car-&gt;set_current_signal(&quot;EMERGENCY&quot;);</span>
<span class="lineNum">     218 </span>                :            :   } else {
<span class="lineNum">     219 </span>                :<span class="lineNoCov">          0 :     auto_driving_car-&gt;set_current_signal(&quot;&quot;);</span>
<span class="lineNum">     220 </span>                :            :   }
<a name="221"><span class="lineNum">     221 </span>                :<span class="lineCov">          2 : }</span></a>
<span class="lineNum">     222 </span>                :            : 
<span class="lineNum">     223 </span>                :<span class="lineNoCov">          0 : void DownsampleCurve(Curve *curve) {</span>
<span class="lineNum">     224 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: DownsampleCurve&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">     225 </span>                :            : 
<span class="lineNum">     226 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   if (curve-&gt;segment().empty()) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">     227 </span>                :<span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     228 </span>                :            :   }
<span class="lineNum">     229 </span>                :            : 
<span class="lineNum">     230 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   auto *line_segment = curve-&gt;mutable_segment(0)-&gt;mutable_line_segment();</span>
<span class="lineNum">     231 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   std::vector&lt;PointENU&gt; points(line_segment-&gt;point().begin(),</span>
<span class="lineNum">     232 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                line_segment-&gt;point().end());</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">     233 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   line_segment-&gt;clear_point();</span>
<span class="lineNum">     234 </span>                :            : 
<span class="lineNum">     235 </span>                :            :   // Downsample points by angle then by distance.
<span class="lineNum">     236 </span>                :            :   std::vector&lt;size_t&gt; sampled_indices =
<span class="lineNum">     237 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :       DownsampleByAngle(points, kAngleThreshold);</span>
<span class="lineNum">     238 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (const size_t index : sampled_indices) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">     239 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     *line_segment-&gt;add_point() = points[index];</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     240 </span>                :<span class="lineNoCov">          0 :   }</span>
<a name="241"><span class="lineNum">     241 </span>                :            : }</a>
<span class="lineNum">     242 </span>                :            : 
<span class="lineNum">     243 </span>                :<span class="lineNoCov">          0 : inline double SecToMs(const double sec) {</span>
<span class="lineNum">     244 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SecToMs&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">     245 </span>                :<span class="lineNoCov">          0 :  return sec * 1000.0; }</span>
<span class="lineNum">     246 </span>                :            : 
<span class="lineNum">     247 </span>                :            : }  // namespace
<span class="lineNum">     248 </span>                :            : 
<a name="249"><span class="lineNum">     249 </span>                :            : constexpr int SimulationWorldService::kMaxMonitorItems;</a>
<span class="lineNum">     250 </span>                :            : 
<span class="lineNum">     251 </span>                :<span class="lineCov">         16 : SimulationWorldService::SimulationWorldService(const MapService *map_service,</span>
<span class="lineNum">     252 </span>                :            :                                                bool routing_from_file)
<span class="lineNum">     253 </span>                :            :     : node_(cyber::CreateNode(&quot;simulation_world&quot;)),
<span class="lineNum">     254 </span>                :            :       map_service_(map_service),
<span class="lineNum">     255 </span>                :            :       monitor_logger_buffer_(MonitorMessageItem::SIMULATOR),
<span class="lineNum">     256 </span>[<span class="branchCov" title="Branch 2 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 6 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]:<span class="lineCov">         16 :       ready_to_push_(false) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 9 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 19 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 20 was not taken"> - </span>][<span class="branchCov" title="Branch 22 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 23 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 26 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 27 was not taken"> - </span>][<span class="branchCov" title="Branch 30 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 31 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 33 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 34 was not taken"> - </span>][<span class="branchCov" title="Branch 36 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 37 was not taken"> - </span>]
<span class="lineNum">     257 </span>[<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         16 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::SimulationWorldService&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">     258 </span>                :            : 
<span class="lineNum">     259 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :   InitReaders();</span>
<span class="lineNum">     260 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :   InitWriters();</span>
<span class="lineNum">     261 </span>                :            : 
<span class="lineNum">     262 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 15 times"> + </span>]:<span class="lineCov">         16 :   if (routing_from_file) {</span>
<span class="lineNum">     263 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :     ReadRoutingFromFile(FLAGS_routing_response_file);</span>
<span class="lineNum">     264 </span>                :            :   }
<span class="lineNum">     265 </span>                :            : 
<span class="lineNum">     266 </span>                :            :   // Populate vehicle parameters.
<span class="lineNum">     267 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :   Object *auto_driving_car = world_.mutable_auto_driving_car();</span>
<span class="lineNum">     268 </span>[<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         16 :   const auto &amp;vehicle_param = VehicleConfigHelper::GetConfig().vehicle_param();</span>
<span class="lineNum">     269 </span>[<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         16 :   auto_driving_car-&gt;set_height(vehicle_param.height());</span>
<span class="lineNum">     270 </span>[<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         16 :   auto_driving_car-&gt;set_width(vehicle_param.width());</span>
<span class="lineNum">     271 </span>[<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         16 :   auto_driving_car-&gt;set_length(vehicle_param.length());</span>
<a name="272"><span class="lineNum">     272 </span>                :<span class="lineCov">         16 : }</span></a>
<span class="lineNum">     273 </span>                :            : 
<span class="lineNum">     274 </span>                :<span class="lineCov">         16 : void SimulationWorldService::InitReaders() {</span>
<span class="lineNum">     275 </span>[<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         16 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::InitReaders&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">     276 </span>                :            : 
<span class="lineNum">     277 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         32 :   routing_request_reader_ =</span>
<span class="lineNum">     278 </span>                :<span class="lineCov">         16 :       node_-&gt;CreateReader&lt;RoutingRequest&gt;(FLAGS_routing_request_topic);</span>
<span class="lineNum">     279 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         32 :   routing_response_reader_ =</span>
<span class="lineNum">     280 </span>                :<span class="lineCov">         16 :       node_-&gt;CreateReader&lt;RoutingResponse&gt;(FLAGS_routing_response_topic);</span>
<span class="lineNum">     281 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         16 :   chassis_reader_ = node_-&gt;CreateReader&lt;Chassis&gt;(FLAGS_chassis_topic);</span>
<span class="lineNum">     282 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         16 :   gps_reader_ = node_-&gt;CreateReader&lt;Gps&gt;(FLAGS_gps_topic);</span>
<span class="lineNum">     283 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         32 :   localization_reader_ =</span>
<span class="lineNum">     284 </span>                :<span class="lineCov">         16 :       node_-&gt;CreateReader&lt;LocalizationEstimate&gt;(FLAGS_localization_topic);</span>
<span class="lineNum">     285 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         32 :   perception_obstacle_reader_ =</span>
<span class="lineNum">     286 </span>                :<span class="lineCov">         16 :       node_-&gt;CreateReader&lt;PerceptionObstacles&gt;(FLAGS_perception_obstacle_topic);</span>
<span class="lineNum">     287 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         32 :   perception_traffic_light_reader_ = node_-&gt;CreateReader&lt;TrafficLightDetection&gt;(</span>
<span class="lineNum">     288 </span>                :<span class="lineCov">         16 :       FLAGS_traffic_light_detection_topic);</span>
<span class="lineNum">     289 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         32 :   prediction_obstacle_reader_ =</span>
<span class="lineNum">     290 </span>                :<span class="lineCov">         16 :       node_-&gt;CreateReader&lt;PredictionObstacles&gt;(FLAGS_prediction_topic);</span>
<span class="lineNum">     291 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         32 :   planning_reader_ =</span>
<span class="lineNum">     292 </span>                :<span class="lineCov">         16 :       node_-&gt;CreateReader&lt;ADCTrajectory&gt;(FLAGS_planning_trajectory_topic);</span>
<span class="lineNum">     293 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         32 :   control_command_reader_ =</span>
<span class="lineNum">     294 </span>                :<span class="lineCov">         16 :       node_-&gt;CreateReader&lt;ControlCommand&gt;(FLAGS_control_command_topic);</span>
<span class="lineNum">     295 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         32 :   navigation_reader_ =</span>
<span class="lineNum">     296 </span>                :<span class="lineCov">         16 :       node_-&gt;CreateReader&lt;NavigationInfo&gt;(FLAGS_navigation_topic);</span>
<span class="lineNum">     297 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         16 :   relative_map_reader_ = node_-&gt;CreateReader&lt;MapMsg&gt;(FLAGS_relative_map_topic);</span>
<span class="lineNum">     298 </span>        [<span class="branchCov" title="Branch 3 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         16 :   storytelling_reader_ = node_-&gt;CreateReader&lt;Stories&gt;(FLAGS_storytelling_topic);</span>
<span class="lineNum">     299 </span>                :            : 
<a name="300"><span class="lineNum">     300 </span>[<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         32 :   drive_event_reader_ = node_-&gt;CreateReader&lt;DriveEvent&gt;(</span></a>
<span class="lineNum">     301 </span>                :            :       FLAGS_drive_event_topic,
<span class="lineNum">     302 </span>                :<span class="lineNoCov">          0 :       [this](const std::shared_ptr&lt;DriveEvent&gt; &amp;drive_event) {</span>
<span class="lineNum">     303 </span>                :            :         this-&gt;PublishMonitorMessage(MonitorMessageItem::WARN,
<span class="lineNum">     304 </span>                :<span class="lineNoCov">          0 :                                     drive_event-&gt;event());</span>
<span class="lineNum">     305 </span>                :<span class="lineCov">         16 :       });</span>
<span class="lineNum">     306 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :   cyber::ReaderConfig monitor_message_reader_config;</span>
<span class="lineNum">     307 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :   monitor_message_reader_config.channel_name = FLAGS_monitor_topic;</span>
<span class="lineNum">     308 </span>                :            :   monitor_message_reader_config.pending_queue_size =
<span class="lineNum">     309 </span>                :<span class="lineCov">         16 :       FLAGS_monitor_msg_pending_queue_size;</span>
<a name="310"><span class="lineNum">     310 </span>[<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         32 :   monitor_reader_ = node_-&gt;CreateReader&lt;MonitorMessage&gt;(</span></a>
<span class="lineNum">     311 </span>                :            :       monitor_message_reader_config,
<span class="lineNum">     312 </span>                :<span class="lineNoCov">          0 :       [this](const std::shared_ptr&lt;MonitorMessage&gt; &amp;monitor_message) {</span>
<span class="lineNum">     313 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         std::unique_lock&lt;std::mutex&gt; lock(monitor_msgs_mutex_);</span>
<span class="lineNum">     314 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         monitor_msgs_.push_back(monitor_message);</span>
<span class="lineNum">     315 </span>                :<span class="lineCov">         32 :       });</span>
<a name="316"><span class="lineNum">     316 </span>                :<span class="lineCov">         16 : }</span></a>
<span class="lineNum">     317 </span>                :            : 
<span class="lineNum">     318 </span>                :<span class="lineCov">         16 : void SimulationWorldService::InitWriters() {</span>
<span class="lineNum">     319 </span>[<span class="branchCov" title="Branch 2 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">         16 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::InitWriters&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     320 </span>                :            : 
<span class="lineNum">     321 </span>                :<span class="lineCov">         32 :   navigation_writer_ =</span>
<span class="lineNum">     322 </span>                :<span class="lineCov">         16 :       node_-&gt;CreateWriter&lt;NavigationInfo&gt;(FLAGS_navigation_topic);</span>
<span class="lineNum">     323 </span>                :            : 
<span class="lineNum">     324 </span>                :            :   {  // configure QoS for routing request writer
<span class="lineNum">     325 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :     apollo::cyber::proto::RoleAttributes routing_request_attr;</span>
<span class="lineNum">     326 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :     routing_request_attr.set_channel_name(FLAGS_routing_request_topic);</span>
<span class="lineNum">     327 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :     auto qos = routing_request_attr.mutable_qos_profile();</span>
<span class="lineNum">     328 </span>                :            :     // only keeps the last message in history
<span class="lineNum">     329 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :     qos-&gt;set_history(apollo::cyber::proto::QosHistoryPolicy::HISTORY_KEEP_LAST);</span>
<span class="lineNum">     330 </span>                :            :     // reliable transfer
<span class="lineNum">     331 </span>                :            :     qos-&gt;set_reliability(
<span class="lineNum">     332 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :         apollo::cyber::proto::QosReliabilityPolicy::RELIABILITY_RELIABLE);</span>
<span class="lineNum">     333 </span>                :            :     // when writer find new readers, send all its history messsage
<span class="lineNum">     334 </span>                :            :     qos-&gt;set_durability(
<span class="lineNum">     335 </span>        [<span class="branchCov" title="Branch 1 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         16 :         apollo::cyber::proto::QosDurabilityPolicy::DURABILITY_TRANSIENT_LOCAL);</span>
<span class="lineNum">     336 </span>        [<span class="branchCov" title="Branch 2 was taken 16 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         32 :     routing_request_writer_ =</span>
<span class="lineNum">     337 </span>                :<span class="lineCov">         32 :         node_-&gt;CreateWriter&lt;RoutingRequest&gt;(routing_request_attr);</span>
<span class="lineNum">     338 </span>                :            :   }
<span class="lineNum">     339 </span>                :            : 
<span class="lineNum">     340 </span>                :<span class="lineCov">         32 :   routing_response_writer_ =</span>
<span class="lineNum">     341 </span>                :<span class="lineCov">         16 :       node_-&gt;CreateWriter&lt;RoutingResponse&gt;(FLAGS_routing_response_topic);</span>
<a name="342"><span class="lineNum">     342 </span>                :<span class="lineCov">         16 : }</span></a>
<span class="lineNum">     343 </span>                :            : 
<span class="lineNum">     344 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::Update() {</span>
<span class="lineNum">     345 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::Update&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">     346 </span>                :            : 
<span class="lineNum">     347 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   if (to_clear_) {</span>
<span class="lineNum">     348 </span>                :            :     // Clears received data.
<span class="lineNum">     349 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :     node_-&gt;ClearData();</span>
<span class="lineNum">     350 </span>                :            : 
<span class="lineNum">     351 </span>                :            :     // Clears simulation world except for the car information.
<span class="lineNum">     352 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     auto car = world_.auto_driving_car();</span>
<span class="lineNum">     353 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     world_.Clear();</span>
<span class="lineNum">     354 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     *world_.mutable_auto_driving_car() = car;</span>
<span class="lineNum">     355 </span>                :            : 
<span class="lineNum">     356 </span>                :            :     {
<span class="lineNum">     357 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :       boost::unique_lock&lt;boost::shared_mutex&gt; writer_lock(route_paths_mutex_);</span>
<span class="lineNum">     358 </span>                :<span class="lineNoCov">          0 :       route_paths_.clear();</span>
<span class="lineNum">     359 </span>                :            :     }
<span class="lineNum">     360 </span>                :            : 
<span class="lineNum">     361 </span>                :<span class="lineNoCov">          0 :     to_clear_ = false;</span>
<span class="lineNum">     362 </span>                :            :   }
<span class="lineNum">     363 </span>                :            : 
<span class="lineNum">     364 </span>                :<span class="lineNoCov">          0 :   node_-&gt;Observe();</span>
<span class="lineNum">     365 </span>                :            : 
<span class="lineNum">     366 </span>                :<span class="lineNoCov">          0 :   UpdateMonitorMessages();</span>
<span class="lineNum">     367 </span>                :            : 
<span class="lineNum">     368 </span>                :<span class="lineNoCov">          0 :   UpdateWithLatestObserved(routing_response_reader_.get(), false);</span>
<span class="lineNum">     369 </span>                :<span class="lineNoCov">          0 :   UpdateWithLatestObserved(chassis_reader_.get());</span>
<span class="lineNum">     370 </span>                :<span class="lineNoCov">          0 :   UpdateWithLatestObserved(gps_reader_.get());</span>
<span class="lineNum">     371 </span>                :<span class="lineNoCov">          0 :   UpdateWithLatestObserved(localization_reader_.get());</span>
<span class="lineNum">     372 </span>                :            : 
<span class="lineNum">     373 </span>                :            :   // Clear objects received from last frame and populate with the new objects.
<span class="lineNum">     374 </span>                :            :   // TODO(siyangy, unacao): For now we are assembling the simulation_world with
<span class="lineNum">     375 </span>                :            :   // latest received perception, prediction and planning message. However, they
<span class="lineNum">     376 </span>                :            :   // may not always be perfectly aligned and belong to the same frame.
<span class="lineNum">     377 </span>                :<span class="lineNoCov">          0 :   obj_map_.clear();</span>
<span class="lineNum">     378 </span>                :<span class="lineNoCov">          0 :   world_.clear_object();</span>
<span class="lineNum">     379 </span>                :<span class="lineNoCov">          0 :   UpdateWithLatestObserved(storytelling_reader_.get());</span>
<span class="lineNum">     380 </span>                :<span class="lineNoCov">          0 :   UpdateWithLatestObserved(perception_obstacle_reader_.get());</span>
<span class="lineNum">     381 </span>                :<span class="lineNoCov">          0 :   UpdateWithLatestObserved(perception_traffic_light_reader_.get(), false);</span>
<span class="lineNum">     382 </span>                :<span class="lineNoCov">          0 :   UpdateWithLatestObserved(prediction_obstacle_reader_.get());</span>
<span class="lineNum">     383 </span>                :<span class="lineNoCov">          0 :   UpdateWithLatestObserved(planning_reader_.get());</span>
<span class="lineNum">     384 </span>                :<span class="lineNoCov">          0 :   UpdateWithLatestObserved(control_command_reader_.get());</span>
<span class="lineNum">     385 </span>                :<span class="lineNoCov">          0 :   UpdateWithLatestObserved(navigation_reader_.get(), FLAGS_use_navigation_mode);</span>
<span class="lineNum">     386 </span>                :            :   UpdateWithLatestObserved(relative_map_reader_.get(),
<span class="lineNum">     387 </span>                :<span class="lineNoCov">          0 :                            FLAGS_use_navigation_mode);</span>
<span class="lineNum">     388 </span>                :            : 
<span class="lineNum">     389 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (const auto &amp;kv : obj_map_) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">     390 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     *world_.add_object() = kv.second;</span>
<span class="lineNum">     391 </span>                :            :   }
<span class="lineNum">     392 </span>                :            : 
<span class="lineNum">     393 </span>                :<span class="lineNoCov">          0 :   UpdateDelays();</span>
<span class="lineNum">     394 </span>                :<span class="lineNoCov">          0 :   UpdateLatencies();</span>
<span class="lineNum">     395 </span>                :            : 
<span class="lineNum">     396 </span>                :<span class="lineNoCov">          0 :   world_.set_sequence_num(world_.sequence_num() + 1);</span>
<span class="lineNum">     397 </span>                :<span class="lineNoCov">          0 :   world_.set_timestamp(static_cast&lt;double&gt;(absl::ToUnixMillis(Clock::Now())));</span>
<a name="398"><span class="lineNum">     398 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     399 </span>                :            : 
<span class="lineNum">     400 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::UpdateDelays() {</span>
<span class="lineNum">     401 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateDelays&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">     402 </span>                :            : 
<span class="lineNum">     403 </span>                :<span class="lineNoCov">          0 :   auto *delays = world_.mutable_delay();</span>
<span class="lineNum">     404 </span>                :<span class="lineNoCov">          0 :   delays-&gt;set_chassis(SecToMs(chassis_reader_-&gt;GetDelaySec()));</span>
<span class="lineNum">     405 </span>                :<span class="lineNoCov">          0 :   delays-&gt;set_localization(SecToMs(localization_reader_-&gt;GetDelaySec()));</span>
<span class="lineNum">     406 </span>                :            :   delays-&gt;set_perception_obstacle(
<span class="lineNum">     407 </span>                :<span class="lineNoCov">          0 :       SecToMs(perception_obstacle_reader_-&gt;GetDelaySec()));</span>
<span class="lineNum">     408 </span>                :<span class="lineNoCov">          0 :   delays-&gt;set_planning(SecToMs(planning_reader_-&gt;GetDelaySec()));</span>
<span class="lineNum">     409 </span>                :<span class="lineNoCov">          0 :   delays-&gt;set_prediction(SecToMs(prediction_obstacle_reader_-&gt;GetDelaySec()));</span>
<span class="lineNum">     410 </span>                :            :   delays-&gt;set_traffic_light(
<span class="lineNum">     411 </span>                :<span class="lineNoCov">          0 :       SecToMs(perception_traffic_light_reader_-&gt;GetDelaySec()));</span>
<span class="lineNum">     412 </span>                :<span class="lineNoCov">          0 :   delays-&gt;set_control(SecToMs(control_command_reader_-&gt;GetDelaySec()));</span>
<a name="413"><span class="lineNum">     413 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     414 </span>                :            : 
<span class="lineNum">     415 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::UpdateLatencies() {</span>
<span class="lineNum">     416 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateLatencies&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">     417 </span>                :            : 
<span class="lineNum">     418 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :   UpdateLatency(&quot;chassis&quot;, chassis_reader_.get());</span>
<span class="lineNum">     419 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :   UpdateLatency(&quot;localization&quot;, localization_reader_.get());</span>
<span class="lineNum">     420 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :   UpdateLatency(&quot;perception&quot;, perception_obstacle_reader_.get());</span>
<span class="lineNum">     421 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :   UpdateLatency(&quot;planning&quot;, planning_reader_.get());</span>
<span class="lineNum">     422 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :   UpdateLatency(&quot;prediction&quot;, prediction_obstacle_reader_.get());</span>
<span class="lineNum">     423 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :   UpdateLatency(&quot;control&quot;, control_command_reader_.get());</span>
<a name="424"><span class="lineNum">     424 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     425 </span>                :            : 
<span class="lineNum">     426 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::GetWireFormatString(</span>
<span class="lineNum">     427 </span>                :            :     double radius, std::string *sim_world,
<span class="lineNum">     428 </span>                :            :     std::string *sim_world_with_planning_data) {
<span class="lineNum">     429 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::GetWireFormatString&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">     430 </span>                :            : 
<span class="lineNum">     431 </span>                :<span class="lineNoCov">          0 :   PopulateMapInfo(radius);</span>
<span class="lineNum">     432 </span>                :            : 
<span class="lineNum">     433 </span>                :<span class="lineNoCov">          0 :   world_.SerializeToString(sim_world_with_planning_data);</span>
<span class="lineNum">     434 </span>                :            : 
<span class="lineNum">     435 </span>                :<span class="lineNoCov">          0 :   world_.clear_planning_data();</span>
<span class="lineNum">     436 </span>                :<span class="lineNoCov">          0 :   world_.SerializeToString(sim_world);</span>
<a name="437"><span class="lineNum">     437 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     438 </span>                :            : 
<span class="lineNum">     439 </span>                :<span class="lineNoCov">          0 : Json SimulationWorldService::GetUpdateAsJson(double radius) const {</span>
<span class="lineNum">     440 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::GetUpdateAsJson&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">     441 </span>                :            : 
<span class="lineNum">     442 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   std::string sim_world_json_string;</span>
<span class="lineNum">     443 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   MessageToJsonString(world_, &amp;sim_world_json_string);</span>
<span class="lineNum">     444 </span>                :            : 
<span class="lineNum">     445 </span>                :<span class="lineNoCov">          0 :   Json update;</span>
<span class="lineNum">     446 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   update[&quot;type&quot;] = &quot;SimWorldUpdate&quot;;</span>
<span class="lineNum">     447 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   update[&quot;timestamp&quot;] = absl::ToUnixMillis(Clock::Now());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<span class="lineNum">     448 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   update[&quot;world&quot;] = sim_world_json_string;</span>
<span class="lineNum">     449 </span>                :            : 
<span class="lineNum">     450 </span>                :<span class="lineNoCov">          0 :   return update;</span>
<a name="451"><span class="lineNum">     451 </span>                :            : }</a>
<span class="lineNum">     452 </span>                :            : 
<span class="lineNum">     453 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::GetMapElementIds(double radius,</span>
<span class="lineNum">     454 </span>                :            :                                               MapElementIds *ids) const {
<span class="lineNum">     455 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::GetMapElementIds&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">     456 </span>                :            : 
<span class="lineNum">     457 </span>                :            :   // Gather required map element ids based on current location.
<span class="lineNum">     458 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   apollo::common::PointENU point;</span>
<span class="lineNum">     459 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   const auto &amp;adc = world_.auto_driving_car();</span>
<span class="lineNum">     460 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   point.set_x(adc.position_x());</span>
<span class="lineNum">     461 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   point.set_y(adc.position_y());</span>
<span class="lineNum">     462 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   map_service_-&gt;CollectMapElementIds(point, radius, ids);</span>
<a name="463"><span class="lineNum">     463 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     464 </span>                :            : 
<span class="lineNum">     465 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::PopulateMapInfo(double radius) {</span>
<span class="lineNum">     466 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::PopulateMapInfo&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">     467 </span>                :            : 
<span class="lineNum">     468 </span>                :<span class="lineNoCov">          0 :   world_.clear_map_element_ids();</span>
<span class="lineNum">     469 </span>                :<span class="lineNoCov">          0 :   GetMapElementIds(radius, world_.mutable_map_element_ids());</span>
<span class="lineNum">     470 </span>                :<span class="lineNoCov">          0 :   world_.set_map_hash(map_service_-&gt;CalculateMapHash(world_.map_element_ids()));</span>
<span class="lineNum">     471 </span>                :<span class="lineNoCov">          0 :   world_.set_map_radius(radius);</span>
<a name="472"><span class="lineNum">     472 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     473 </span>                :            : 
<span class="lineNum">     474 </span>                :<span class="lineNoCov">          0 : const Map &amp;SimulationWorldService::GetRelativeMap() const {</span>
<span class="lineNum">     475 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: &amp;SimulationWorldService::GetRelativeMap&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">     476 </span>                :            : 
<span class="lineNum">     477 </span>                :<span class="lineNoCov">          0 :   return relative_map_;</span>
<span class="lineNum">     478 </span>                :            : }
<a name="479"><span class="lineNum">     479 </span>                :            : </a>
<span class="lineNum">     480 </span>                :            : template &lt;&gt;
<span class="lineNum">     481 </span>                :<span class="lineCov">          1 : void SimulationWorldService::UpdateSimulationWorld(</span>
<span class="lineNum">     482 </span>                :            :     const LocalizationEstimate &amp;localization) {
<span class="lineNum">     483 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     484 </span>                :            : 
<span class="lineNum">     485 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     486 </span>                :            : 
<span class="lineNum">     487 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     488 </span>                :            : 
<span class="lineNum">     489 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     490 </span>                :            : 
<span class="lineNum">     491 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     492 </span>                :            : 
<span class="lineNum">     493 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     494 </span>                :            : 
<span class="lineNum">     495 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     496 </span>                :            : 
<span class="lineNum">     497 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     498 </span>                :            : 
<span class="lineNum">     499 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     500 </span>                :            : 
<span class="lineNum">     501 </span>                :<span class="lineCov">          1 :   Object *auto_driving_car = world_.mutable_auto_driving_car();</span>
<span class="lineNum">     502 </span>                :<span class="lineCov">          1 :   const auto &amp;pose = localization.pose();</span>
<span class="lineNum">     503 </span>                :            : 
<span class="lineNum">     504 </span>                :            :   // Updates position with the input localization message.
<span class="lineNum">     505 </span>                :<span class="lineCov">          1 :   auto_driving_car-&gt;set_position_x(pose.position().x() +</span>
<span class="lineNum">     506 </span>                :<span class="lineCov">          1 :                                    map_service_-&gt;GetXOffset());</span>
<span class="lineNum">     507 </span>                :<span class="lineCov">          1 :   auto_driving_car-&gt;set_position_y(pose.position().y() +</span>
<span class="lineNum">     508 </span>                :<span class="lineCov">          1 :                                    map_service_-&gt;GetYOffset());</span>
<span class="lineNum">     509 </span>                :<span class="lineCov">          1 :   auto_driving_car-&gt;set_heading(pose.heading());</span>
<span class="lineNum">     510 </span>                :            : 
<span class="lineNum">     511 </span>                :            :   // Updates acceleration with the input localization message.
<span class="lineNum">     512 </span>                :            :   auto_driving_car-&gt;set_speed_acceleration(CalculateAcceleration(
<span class="lineNum">     513 </span>                :<span class="lineCov">          1 :       pose.linear_acceleration(), pose.linear_velocity(), gear_location_));</span>
<span class="lineNum">     514 </span>                :            : 
<span class="lineNum">     515 </span>                :            :   // Updates the timestamp with the timestamp inside the localization
<span class="lineNum">     516 </span>                :            :   // message header. It is done on both the SimulationWorld object
<span class="lineNum">     517 </span>                :            :   // itself and its auto_driving_car() field.
<span class="lineNum">     518 </span>                :<span class="lineCov">          1 :   auto_driving_car-&gt;set_timestamp_sec(localization.header().timestamp_sec());</span>
<span class="lineNum">     519 </span>                :            : 
<span class="lineNum">     520 </span>                :<span class="lineCov">          1 :   ready_to_push_.store(true);</span>
<span class="lineNum">     521 </span>                :<span class="lineCov">          1 : }</span>
<a name="522"><span class="lineNum">     522 </span>                :            : </a>
<span class="lineNum">     523 </span>                :            : template &lt;&gt;
<span class="lineNum">     524 </span>                :<span class="lineCov">          1 : void SimulationWorldService::UpdateSimulationWorld(const Gps &amp;gps) {</span>
<span class="lineNum">     525 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     526 </span>                :            : 
<span class="lineNum">     527 </span>        [<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (gps.header().module_name() == &quot;ShadowLocalization&quot;) {</span>
<span class="lineNum">     528 </span>                :<span class="lineNoCov">          0 :     Object *shadow_localization_position = world_.mutable_shadow_localization();</span>
<span class="lineNum">     529 </span>                :<span class="lineNoCov">          0 :     const auto &amp;pose = gps.localization();</span>
<span class="lineNum">     530 </span>                :<span class="lineNoCov">          0 :     shadow_localization_position-&gt;set_position_x(pose.position().x() +</span>
<span class="lineNum">     531 </span>                :<span class="lineNoCov">          0 :                                                  map_service_-&gt;GetXOffset());</span>
<span class="lineNum">     532 </span>                :<span class="lineNoCov">          0 :     shadow_localization_position-&gt;set_position_y(pose.position().y() +</span>
<span class="lineNum">     533 </span>                :<span class="lineNoCov">          0 :                                                  map_service_-&gt;GetYOffset());</span>
<span class="lineNum">     534 </span>                :<span class="lineNoCov">          0 :     shadow_localization_position-&gt;set_heading(pose.heading());</span>
<span class="lineNum">     535 </span>                :            :   } else {
<span class="lineNum">     536 </span>                :<span class="lineCov">          1 :     Object *gps_position = world_.mutable_gps();</span>
<span class="lineNum">     537 </span>                :<span class="lineCov">          1 :     gps_position-&gt;set_timestamp_sec(gps.header().timestamp_sec());</span>
<span class="lineNum">     538 </span>                :            : 
<span class="lineNum">     539 </span>                :<span class="lineCov">          1 :     const auto &amp;pose = gps.localization();</span>
<span class="lineNum">     540 </span>                :<span class="lineCov">          1 :     gps_position-&gt;set_position_x(pose.position().x() +</span>
<span class="lineNum">     541 </span>                :<span class="lineCov">          1 :                                  map_service_-&gt;GetXOffset());</span>
<span class="lineNum">     542 </span>                :<span class="lineCov">          1 :     gps_position-&gt;set_position_y(pose.position().y() +</span>
<span class="lineNum">     543 </span>                :<span class="lineCov">          1 :                                  map_service_-&gt;GetYOffset());</span>
<span class="lineNum">     544 </span>                :            : 
<span class="lineNum">     545 </span>                :            :     double heading = apollo::common::math::QuaternionToHeading(
<span class="lineNum">     546 </span>                :<span class="lineCov">          2 :         pose.orientation().qw(), pose.orientation().qx(),</span>
<span class="lineNum">     547 </span>                :<span class="lineCov">          3 :         pose.orientation().qy(), pose.orientation().qz());</span>
<span class="lineNum">     548 </span>                :<span class="lineCov">          1 :     gps_position-&gt;set_heading(heading);</span>
<span class="lineNum">     549 </span>                :            :   }
<span class="lineNum">     550 </span>                :<span class="lineCov">          1 : }</span>
<a name="551"><span class="lineNum">     551 </span>                :            : </a>
<span class="lineNum">     552 </span>                :            : template &lt;&gt;
<span class="lineNum">     553 </span>                :<span class="lineCov">          1 : void SimulationWorldService::UpdateSimulationWorld(const Chassis &amp;chassis) {</span>
<span class="lineNum">     554 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     555 </span>                :            : 
<span class="lineNum">     556 </span>                :<span class="lineCov">          1 :   const auto &amp;vehicle_param = VehicleConfigHelper::GetConfig().vehicle_param();</span>
<span class="lineNum">     557 </span>                :<span class="lineCov">          1 :   Object *auto_driving_car = world_.mutable_auto_driving_car();</span>
<span class="lineNum">     558 </span>                :            : 
<span class="lineNum">     559 </span>                :<span class="lineCov">          1 :   double speed = chassis.speed_mps();</span>
<span class="lineNum">     560 </span>                :<span class="lineCov">          1 :   gear_location_ = chassis.gear_location();</span>
<span class="lineNum">     561 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (gear_location_ == Chassis::GEAR_REVERSE) {</span>
<span class="lineNum">     562 </span>                :<span class="lineNoCov">          0 :     speed = -speed;</span>
<span class="lineNum">     563 </span>                :            :   }
<span class="lineNum">     564 </span>                :<span class="lineCov">          1 :   auto_driving_car-&gt;set_speed(speed);</span>
<span class="lineNum">     565 </span>                :<span class="lineCov">          1 :   auto_driving_car-&gt;set_throttle_percentage(chassis.throttle_percentage());</span>
<span class="lineNum">     566 </span>                :<span class="lineCov">          1 :   auto_driving_car-&gt;set_brake_percentage(chassis.brake_percentage());</span>
<span class="lineNum">     567 </span>                :            : 
<span class="lineNum">     568 </span>                :            :   // In case of out-of-range percentages, reduces it to zero.
<span class="lineNum">     569 </span>                :<span class="lineCov">          1 :   double angle_percentage = chassis.steering_percentage();</span>
<span class="lineNum">     570 </span>[<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (angle_percentage &gt; 100 || angle_percentage &lt; -100) {</span>
<span class="lineNum">     571 </span>                :<span class="lineNoCov">          0 :     angle_percentage = 0;</span>
<span class="lineNum">     572 </span>                :            :   }
<span class="lineNum">     573 </span>                :<span class="lineCov">          1 :   auto_driving_car-&gt;set_steering_percentage(angle_percentage);</span>
<span class="lineNum">     574 </span>                :            : 
<span class="lineNum">     575 </span>                :            :   double steering_angle =
<span class="lineNum">     576 </span>                :<span class="lineCov">          1 :       angle_percentage / 100.0 * vehicle_param.max_steer_angle();</span>
<span class="lineNum">     577 </span>                :<span class="lineCov">          1 :   auto_driving_car-&gt;set_steering_angle(steering_angle);</span>
<span class="lineNum">     578 </span>                :            : 
<span class="lineNum">     579 </span>                :<span class="lineCov">          1 :   double kappa = std::tan(steering_angle / vehicle_param.steer_ratio()) /</span>
<span class="lineNum">     580 </span>                :<span class="lineCov">          1 :                  vehicle_param.wheel_base();</span>
<span class="lineNum">     581 </span>                :<span class="lineCov">          1 :   auto_driving_car-&gt;set_kappa(kappa);</span>
<span class="lineNum">     582 </span>                :            : 
<span class="lineNum">     583 </span>                :<span class="lineCov">          1 :   UpdateTurnSignal(chassis.signal(), auto_driving_car);</span>
<span class="lineNum">     584 </span>                :            : 
<span class="lineNum">     585 </span>                :<span class="lineCov">          1 :   auto_driving_car-&gt;set_disengage_type(DeduceDisengageType(chassis));</span>
<span class="lineNum">     586 </span>                :<span class="lineCov">          1 : }</span>
<a name="587"><span class="lineNum">     587 </span>                :            : </a>
<span class="lineNum">     588 </span>                :            : template &lt;&gt;
<span class="lineNum">     589 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::UpdateSimulationWorld(const Stories &amp;stories) {</span>
<span class="lineNum">     590 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">     591 </span>                :            : 
<span class="lineNum">     592 </span>                :<span class="lineNoCov">          0 :   world_.clear_stories();</span>
<span class="lineNum">     593 </span>                :<span class="lineNoCov">          0 :   auto *world_stories = world_.mutable_stories();</span>
<span class="lineNum">     594 </span>                :            : 
<span class="lineNum">     595 </span>                :<span class="lineNoCov">          0 :   const google::protobuf::Descriptor *descriptor = stories.GetDescriptor();</span>
<span class="lineNum">     596 </span>                :<span class="lineNoCov">          0 :   const google::protobuf::Reflection *reflection = stories.GetReflection();</span>
<span class="lineNum">     597 </span>                :<span class="lineNoCov">          0 :   const int field_count = descriptor-&gt;field_count();</span>
<span class="lineNum">     598 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (int i = 0; i &lt; field_count; ++i) {</span>
<span class="lineNum">     599 </span>                :<span class="lineNoCov">          0 :     const google::protobuf::FieldDescriptor *field = descriptor-&gt;field(i);</span>
<span class="lineNum">     600 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (field-&gt;name() != &quot;header&quot;) {</span>
<span class="lineNum">     601 </span>                :<span class="lineNoCov">          0 :       (*world_stories)[field-&gt;name()] = reflection-&gt;HasField(stories, field);</span>
<span class="lineNum">     602 </span>                :            :     }
<span class="lineNum">     603 </span>                :            :   }
<a name="604"><span class="lineNum">     604 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     605 </span>                :            : 
<span class="lineNum">     606 </span>                :<span class="lineCov">          5 : Object &amp;SimulationWorldService::CreateWorldObjectIfAbsent(</span>
<span class="lineNum">     607 </span>                :            :     const PerceptionObstacle &amp;obstacle) {
<span class="lineNum">     608 </span>[<span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          5 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: &amp;SimulationWorldService::CreateWorldObjectIfAbsent&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">     609 </span>                :            : 
<span class="lineNum">     610 </span>[<span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          5 :   const std::string id = std::to_string(obstacle.id());</span>
<span class="lineNum">     611 </span>                :            :   // Create a new world object and put it into object map if the id does not
<span class="lineNum">     612 </span>                :            :   // exist in the map yet.
<span class="lineNum">     613 </span>[<span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          5 :   if (!apollo::common::util::ContainsKey(obj_map_, id)) {</span>
<span class="lineNum">     614 </span>        [<span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          5 :     Object &amp;world_obj = obj_map_[id];</span>
<span class="lineNum">     615 </span>        [<span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          5 :     SetObstacleInfo(obstacle, &amp;world_obj);</span>
<span class="lineNum">     616 </span>        [<span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          5 :     SetObstaclePolygon(obstacle, &amp;world_obj);</span>
<span class="lineNum">     617 </span>        [<span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          5 :     SetObstacleType(obstacle, &amp;world_obj);</span>
<span class="lineNum">     618 </span>                :            :   }
<span class="lineNum">     619 </span>        [<span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          5 :   return obj_map_[id];</span>
<a name="620"><span class="lineNum">     620 </span>                :            : }</a>
<span class="lineNum">     621 </span>                :            : 
<span class="lineNum">     622 </span>                :<span class="lineCov">          5 : void SimulationWorldService::SetObstacleInfo(const PerceptionObstacle &amp;obstacle,</span>
<span class="lineNum">     623 </span>                :            :                                              Object *world_object) {
<span class="lineNum">     624 </span>[<span class="branchCov" title="Branch 2 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          5 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::SetObstacleInfo&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     625 </span>                :            : 
<span class="lineNum">     626 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 5 times"> + </span>]:<span class="lineCov">          5 :   if (world_object == nullptr) {</span>
<span class="lineNum">     627 </span>                :<span class="lineCov">          5 :     return;</span>
<span class="lineNum">     628 </span>                :            :   }
<span class="lineNum">     629 </span>                :            : 
<span class="lineNum">     630 </span>        [<span class="branchCov" title="Branch 3 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          5 :   world_object-&gt;set_id(std::to_string(obstacle.id()));</span>
<span class="lineNum">     631 </span>                :<span class="lineCov">          5 :   world_object-&gt;set_position_x(obstacle.position().x() +</span>
<span class="lineNum">     632 </span>                :<span class="lineCov">          5 :                                map_service_-&gt;GetXOffset());</span>
<span class="lineNum">     633 </span>                :<span class="lineCov">          5 :   world_object-&gt;set_position_y(obstacle.position().y() +</span>
<span class="lineNum">     634 </span>                :<span class="lineCov">          5 :                                map_service_-&gt;GetYOffset());</span>
<span class="lineNum">     635 </span>                :<span class="lineCov">          5 :   world_object-&gt;set_heading(obstacle.theta());</span>
<span class="lineNum">     636 </span>                :<span class="lineCov">          5 :   world_object-&gt;set_length(obstacle.length());</span>
<span class="lineNum">     637 </span>                :<span class="lineCov">          5 :   world_object-&gt;set_width(obstacle.width());</span>
<span class="lineNum">     638 </span>                :<span class="lineCov">          5 :   world_object-&gt;set_height(obstacle.height());</span>
<span class="lineNum">     639 </span>                :            :   world_object-&gt;set_speed(
<span class="lineNum">     640 </span>                :<span class="lineCov">          5 :       std::hypot(obstacle.velocity().x(), obstacle.velocity().y()));</span>
<span class="lineNum">     641 </span>                :            :   world_object-&gt;set_speed_heading(
<span class="lineNum">     642 </span>                :<span class="lineCov">          5 :       std::atan2(obstacle.velocity().y(), obstacle.velocity().x()));</span>
<span class="lineNum">     643 </span>                :<span class="lineCov">          5 :   world_object-&gt;set_timestamp_sec(obstacle.timestamp());</span>
<span class="lineNum">     644 </span>                :<span class="lineCov">          5 :   world_object-&gt;set_confidence(obstacle.has_confidence() ? obstacle.confidence()</span>
<span class="lineNum">     645 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 5 times"> + </span>]:<span class="lineCov">          5 :                                                          : 1);</span>
<a name="646"><span class="lineNum">     646 </span>                :            : }</a>
<span class="lineNum">     647 </span>                :            : 
<span class="lineNum">     648 </span>                :<span class="lineCov">          5 : void SimulationWorldService::SetObstaclePolygon(</span>
<span class="lineNum">     649 </span>                :            :     const PerceptionObstacle &amp;obstacle, Object *world_object) {
<span class="lineNum">     650 </span>[<span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          5 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::SetObstaclePolygon&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">     651 </span>                :            : 
<span class="lineNum">     652 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 5 times"> + </span>]:<span class="lineCov">          5 :   if (world_object == nullptr) {</span>
<span class="lineNum">     653 </span>                :<span class="lineCov">          5 :     return;</span>
<span class="lineNum">     654 </span>                :            :   }
<span class="lineNum">     655 </span>                :            : 
<span class="lineNum">     656 </span>                :            :   using apollo::common::util::PairHash;
<span class="lineNum">     657 </span>        [<span class="branchCov" title="Branch 2 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          5 :   std::unordered_set&lt;std::pair&lt;double, double&gt;, PairHash&gt; seen_points;</span>
<span class="lineNum">     658 </span>        [<span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          5 :   world_object-&gt;clear_polygon_point();</span>
<span class="lineNum">     659 </span>[<span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          9 :   for (const auto &amp;point : obstacle.polygon_point()) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 5 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 18 was taken 4 times"> + </span><span class="branchCov" title="Branch 19 was taken 5 times"> + </span>]
<span class="lineNum">     660 </span>                :            :     // Filter out duplicate xy pairs.
<span class="lineNum">     661 </span>[<span class="branchCov" title="Branch 1 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          4 :     std::pair&lt;double, double&gt; xy_pair = {point.x(), point.y()};</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     662 </span>[<span class="branchCov" title="Branch 1 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 3 times"> + </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          4 :     if (seen_points.count(xy_pair) == 0) {</span>
<span class="lineNum">     663 </span>        [<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          3 :       PolygonPoint *poly_pt = world_object-&gt;add_polygon_point();</span>
<span class="lineNum">     664 </span>[<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          3 :       poly_pt-&gt;set_x(point.x() + map_service_-&gt;GetXOffset());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     665 </span>[<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          3 :       poly_pt-&gt;set_y(point.y() + map_service_-&gt;GetYOffset());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     666 </span>        [<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          3 :       seen_points.insert(xy_pair);</span>
<span class="lineNum">     667 </span>                :            :     }
<span class="lineNum">     668 </span>                :<span class="lineCov">          5 :   }</span>
<span class="lineNum">     669 </span>                :            : }
<a name="670"><span class="lineNum">     670 </span>                :            : </a>
<span class="lineNum">     671 </span>                :            : template &lt;&gt;
<span class="lineNum">     672 </span>                :<span class="lineCov">          1 : void SimulationWorldService::UpdateSimulationWorld(</span>
<span class="lineNum">     673 </span>                :            :     const PerceptionObstacles &amp;obstacles) {
<span class="lineNum">     674 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          3 :   for (const auto &amp;obstacle : obstacles.perception_obstacle()) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 18 was taken 2 times"> + </span><span class="branchCov" title="Branch 19 was taken 1 time"> + </span>]
<span class="lineNum">     675 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :     auto &amp;world_obj = CreateWorldObjectIfAbsent(obstacle);</span>
<span class="lineNum">     676 </span>[<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 2 times"> + </span>]:<span class="lineCov">          2 :     if (obstacles.has_cipv_info() &amp;&amp;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>][<span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 2 times"> + </span>]
<span class="lineNum">     677 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         (obstacles.cipv_info().cipv_id() == obstacle.id())) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     678 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :       world_obj.set_type(Object_Type_CIPV);</span>
<span class="lineNum">     679 </span>                :            :     }
<span class="lineNum">     680 </span>                :            :   }
<span class="lineNum">     681 </span>                :            : 
<span class="lineNum">     682 </span>        [<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (obstacles.has_lane_marker()) {</span>
<span class="lineNum">     683 </span>                :<span class="lineNoCov">          0 :     world_.mutable_lane_marker()-&gt;CopyFrom(obstacles.lane_marker());</span>
<span class="lineNum">     684 </span>                :            :   }
<span class="lineNum">     685 </span>                :<span class="lineCov">          1 : }</span>
<a name="686"><span class="lineNum">     686 </span>                :            : </a>
<span class="lineNum">     687 </span>                :            : template &lt;&gt;
<span class="lineNum">     688 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::UpdateSimulationWorld(</span>
<span class="lineNum">     689 </span>                :            :     const TrafficLightDetection &amp;traffic_light_detection) {
<span class="lineNum">     690 </span>                :<span class="lineNoCov">          0 :   world_.clear_perceived_signal();</span>
<span class="lineNum">     691 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (const auto &amp;traffic_light : traffic_light_detection.traffic_light()) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 18 was not executed"> # </span><span class="branchNoExec" title="Branch 19 was not executed"> # </span>]
<span class="lineNum">     692 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     Object *signal = world_.add_perceived_signal();</span>
<span class="lineNum">     693 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     signal-&gt;set_id(traffic_light.id());</span>
<span class="lineNum">     694 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     signal-&gt;set_current_signal(TrafficLight_Color_Name(traffic_light.color()));</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     695 </span>                :            :   }
<a name="696"><span class="lineNum">     696 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     697 </span>                :            : 
<span class="lineNum">     698 </span>                :<span class="lineCov">          1 : void SimulationWorldService::UpdatePlanningTrajectory(</span>
<span class="lineNum">     699 </span>                :            :     const ADCTrajectory &amp;trajectory) {
<span class="lineNum">     700 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdatePlanningTrajectory&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     701 </span>                :            : 
<span class="lineNum">     702 </span>                :            :   // Collect trajectory
<span class="lineNum">     703 </span>                :<span class="lineCov">          1 :   world_.clear_planning_trajectory();</span>
<span class="lineNum">     704 </span>                :<span class="lineCov">          1 :   const double base_time = trajectory.header().timestamp_sec();</span>
<span class="lineNum">     705 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         31 :   for (const TrajectoryPoint &amp;point : trajectory.trajectory_point()) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 31 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 18 was taken 30 times"> + </span><span class="branchCov" title="Branch 19 was taken 1 time"> + </span>]
<span class="lineNum">     706 </span>        [<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         30 :     Object *trajectory_point = world_.add_planning_trajectory();</span>
<span class="lineNum">     707 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :     trajectory_point-&gt;set_timestamp_sec(point.relative_time() + base_time);</span>
<span class="lineNum">     708 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :     trajectory_point-&gt;set_position_x(point.path_point().x() +</span>
<span class="lineNum">     709 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :                                      map_service_-&gt;GetXOffset());</span>
<span class="lineNum">     710 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :     trajectory_point-&gt;set_position_y(point.path_point().y() +</span>
<span class="lineNum">     711 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :                                      map_service_-&gt;GetYOffset());</span>
<span class="lineNum">     712 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :     trajectory_point-&gt;set_speed(point.v());</span>
<span class="lineNum">     713 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :     trajectory_point-&gt;set_speed_acceleration(point.a());</span>
<span class="lineNum">     714 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :     trajectory_point-&gt;set_kappa(point.path_point().kappa());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     715 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :     trajectory_point-&gt;set_dkappa(point.path_point().dkappa());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     716 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :     trajectory_point-&gt;set_heading(point.path_point().theta());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     717 </span>                :            :   }
<span class="lineNum">     718 </span>                :            : 
<span class="lineNum">     719 </span>                :            :   // Update engage advice.
<span class="lineNum">     720 </span>                :            :   // This is a temporary solution, the advice will come from monitor later
<span class="lineNum">     721 </span>        [<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (trajectory.has_engage_advice()) {</span>
<span class="lineNum">     722 </span>                :            :     world_.set_engage_advice(
<span class="lineNum">     723 </span>                :<span class="lineNoCov">          0 :         EngageAdvice_Advice_Name(trajectory.engage_advice().advice()));</span>
<span class="lineNum">     724 </span>                :            :   }
<a name="725"><span class="lineNum">     725 </span>                :<span class="lineCov">          1 : }</span></a>
<span class="lineNum">     726 </span>                :            : 
<span class="lineNum">     727 </span>                :<span class="lineNoCov">          0 : std::string formatDoubleToString(const double data) {</span>
<span class="lineNum">     728 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: formatDoubleToString&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">     729 </span>                :            : 
<span class="lineNum">     730 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   std::stringstream ss;</span>
<span class="lineNum">     731 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   ss &lt;&lt; std::fixed &lt;&lt; std::setprecision(2) &lt;&lt; data;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">     732 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   return ss.str();</span>
<a name="733"><span class="lineNum">     733 </span>                :            : }</a>
<span class="lineNum">     734 </span>                :            : 
<span class="lineNum">     735 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::UpdateRSSInfo(const ADCTrajectory &amp;trajectory) {</span>
<span class="lineNum">     736 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateRSSInfo&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">     737 </span>                :            : 
<span class="lineNum">     738 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   if (trajectory.has_rss_info()) {</span>
<span class="lineNum">     739 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (trajectory.rss_info().is_rss_safe()) {</span>
<span class="lineNum">     740 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :       if (!world_.is_rss_safe()) {</span>
<span class="lineNum">     741 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :         this-&gt;PublishMonitorMessage(MonitorMessageItem::INFO, &quot;RSS safe.&quot;);</span>
<span class="lineNum">     742 </span>                :<span class="lineNoCov">          0 :         world_.set_is_rss_safe(true);</span>
<span class="lineNum">     743 </span>                :            :       }
<span class="lineNum">     744 </span>                :            :     } else {
<span class="lineNum">     745 </span>                :<span class="lineNoCov">          0 :       const double next_real_dist = trajectory.rss_info().cur_dist_lon();</span>
<span class="lineNum">     746 </span>                :            :       const double next_rss_safe_dist =
<span class="lineNum">     747 </span>                :<span class="lineNoCov">          0 :           trajectory.rss_info().rss_safe_dist_lon();</span>
<span class="lineNum">     748 </span>                :            :       // Not update RSS message if data keeps same.
<span class="lineNum">     749 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :       if (std::fabs(current_real_dist_ - next_real_dist) &lt;</span>
<span class="lineNum">     750 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :               common::math::kMathEpsilon &amp;&amp;</span>
<span class="lineNum">     751 </span>                :<span class="lineNoCov">          0 :           std::fabs(current_rss_safe_dist_ - next_rss_safe_dist) &lt;</span>
<span class="lineNum">     752 </span>                :            :               common::math::kMathEpsilon) {
<span class="lineNum">     753 </span>                :<span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     754 </span>                :            :       }
<span class="lineNum">     755 </span>                :            :       this-&gt;PublishMonitorMessage(
<span class="lineNum">     756 </span>                :            :           MonitorMessageItem::ERROR,
<span class="lineNum">     757 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :           &quot;RSS unsafe: \ncurrent distance: &quot; +</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     758 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :               formatDoubleToString(trajectory.rss_info().cur_dist_lon()) +</span>
<span class="lineNum">     759 </span>        [<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :               &quot;\nsafe distance: &quot; +</span>
<span class="lineNum">     760 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :               formatDoubleToString(trajectory.rss_info().rss_safe_dist_lon()));</span>
<span class="lineNum">     761 </span>                :<span class="lineNoCov">          0 :       world_.set_is_rss_safe(false);</span>
<span class="lineNum">     762 </span>                :<span class="lineNoCov">          0 :       current_real_dist_ = next_real_dist;</span>
<span class="lineNum">     763 </span>                :<span class="lineNoCov">          0 :       current_rss_safe_dist_ = next_rss_safe_dist;</span>
<span class="lineNum">     764 </span>                :            :     }
<span class="lineNum">     765 </span>                :            :   }
<a name="766"><span class="lineNum">     766 </span>                :            : }</a>
<span class="lineNum">     767 </span>                :            : 
<span class="lineNum">     768 </span>                :<span class="lineCov">          1 : void SimulationWorldService::UpdateMainStopDecision(</span>
<span class="lineNum">     769 </span>                :            :     const apollo::planning::MainDecision &amp;main_decision,
<span class="lineNum">     770 </span>                :            :     double update_timestamp_sec, Object *world_main_decision) {
<span class="lineNum">     771 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateMainStopDecision&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">     772 </span>                :            : 
<span class="lineNum">     773 </span>                :<span class="lineCov">          1 :   apollo::common::math::Vec2d stop_pt;</span>
<span class="lineNum">     774 </span>                :<span class="lineCov">          1 :   double stop_heading = 0.0;</span>
<span class="lineNum">     775 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   auto decision = world_main_decision-&gt;add_decision();</span>
<span class="lineNum">     776 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   decision-&gt;set_type(Decision::STOP);</span>
<span class="lineNum">     777 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (main_decision.has_not_ready()) {</span>
<span class="lineNum">     778 </span>                :            :     // The car is not ready!
<span class="lineNum">     779 </span>                :            :     // Use the current ADC pose since it is better not to self-drive.
<span class="lineNum">     780 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     stop_pt.set_x(world_.auto_driving_car().position_x());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     781 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     stop_pt.set_y(world_.auto_driving_car().position_y());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     782 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     stop_heading = world_.auto_driving_car().heading();</span>
<span class="lineNum">     783 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     decision-&gt;set_stopreason(Decision::STOP_REASON_NOT_READY);</span>
<span class="lineNum">     784 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   } else if (main_decision.has_estop()) {</span>
<span class="lineNum">     785 </span>                :            :     // Emergency stop.
<span class="lineNum">     786 </span>                :            :     // Use the current ADC pose since it is better to stop immediately.
<span class="lineNum">     787 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     stop_pt.set_x(world_.auto_driving_car().position_x());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     788 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     stop_pt.set_y(world_.auto_driving_car().position_y());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     789 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     stop_heading = world_.auto_driving_car().heading();</span>
<span class="lineNum">     790 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     decision-&gt;set_stopreason(Decision::STOP_REASON_EMERGENCY);</span>
<span class="lineNum">     791 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     world_.mutable_auto_driving_car()-&gt;set_current_signal(&quot;EMERGENCY&quot;);</span>
<span class="lineNum">     792 </span>                :            :   } else {
<span class="lineNum">     793 </span>                :            :     // Normal stop.
<span class="lineNum">     794 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :     const apollo::planning::MainStop &amp;stop = main_decision.stop();</span>
<span class="lineNum">     795 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :     stop_pt.set_x(stop.stop_point().x() + map_service_-&gt;GetXOffset());</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">     796 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :     stop_pt.set_y(stop.stop_point().y() + map_service_-&gt;GetYOffset());</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">     797 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :     stop_heading = stop.stop_heading();</span>
<span class="lineNum">     798 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          1 :     if (stop.has_reason_code()) {</span>
<span class="lineNum">     799 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :       SetStopReason(stop.reason_code(), decision);</span>
<span class="lineNum">     800 </span>                :            :     }
<span class="lineNum">     801 </span>                :            :   }
<span class="lineNum">     802 </span>                :            : 
<span class="lineNum">     803 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :   decision-&gt;set_position_x(stop_pt.x());</span>
<span class="lineNum">     804 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :   decision-&gt;set_position_y(stop_pt.y());</span>
<span class="lineNum">     805 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   decision-&gt;set_heading(stop_heading);</span>
<a name="806"><span class="lineNum">     806 </span>                :<span class="lineCov">          1 : }</span></a>
<span class="lineNum">     807 </span>                :            : 
<span class="lineNum">     808 </span>                :<span class="lineCov">          1 : bool SimulationWorldService::LocateMarker(</span>
<span class="lineNum">     809 </span>                :            :     const apollo::planning::ObjectDecisionType &amp;decision,
<span class="lineNum">     810 </span>                :            :     Decision *world_decision) {
<span class="lineNum">     811 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::LocateMarker&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">     812 </span>                :            : 
<span class="lineNum">     813 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   apollo::common::PointENU fence_point;</span>
<span class="lineNum">     814 </span>                :            :   double heading;
<span class="lineNum">     815 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (decision.has_stop() &amp;&amp; decision.stop().has_stop_point()) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>][<span class="branchNoCov" title="Branch 13 was not taken"> - </span><span class="branchCov" title="Branch 14 was taken 1 time"> + </span>]
<span class="lineNum">     816 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     world_decision-&gt;set_type(Decision_Type_STOP);</span>
<span class="lineNum">     817 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     fence_point = decision.stop().stop_point();</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     818 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     heading = decision.stop().stop_heading();</span>
<span class="lineNum">     819 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   } else if (decision.has_follow() &amp;&amp; decision.follow().has_fence_point()) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>][<span class="branchNoCov" title="Branch 13 was not taken"> - </span><span class="branchCov" title="Branch 14 was taken 1 time"> + </span>]
<span class="lineNum">     820 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     world_decision-&gt;set_type(Decision_Type_FOLLOW);</span>
<span class="lineNum">     821 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     fence_point = decision.follow().fence_point();</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     822 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     heading = decision.follow().fence_heading();</span>
<span class="lineNum">     823 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          1 :   } else if (decision.has_yield() &amp;&amp; decision.yield().has_fence_point()) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>][<span class="branchCov" title="Branch 9 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>][<span class="branchCov" title="Branch 13 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>]
<span class="lineNum">     824 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :     world_decision-&gt;set_type(Decision_Type_YIELD);</span>
<span class="lineNum">     825 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :     fence_point = decision.yield().fence_point();</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     826 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :     heading = decision.yield().fence_heading();</span>
<span class="lineNum">     827 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :   } else if (decision.has_overtake() &amp;&amp; decision.overtake().has_fence_point()) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>][<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>]
<span class="lineNum">     828 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     world_decision-&gt;set_type(Decision_Type_OVERTAKE);</span>
<span class="lineNum">     829 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     fence_point = decision.overtake().fence_point();</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     830 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     heading = decision.overtake().fence_heading();</span>
<span class="lineNum">     831 </span>                :            :   } else {
<span class="lineNum">     832 </span>                :<span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">     833 </span>                :            :   }
<span class="lineNum">     834 </span>                :            : 
<span class="lineNum">     835 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :   world_decision-&gt;set_position_x(fence_point.x() + map_service_-&gt;GetXOffset());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     836 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :   world_decision-&gt;set_position_y(fence_point.y() + map_service_-&gt;GetYOffset());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     837 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   world_decision-&gt;set_heading(heading);</span>
<span class="lineNum">     838 </span>                :<span class="lineCov">          1 :   return true;</span>
<a name="839"><span class="lineNum">     839 </span>                :            : }</a>
<span class="lineNum">     840 </span>                :            : 
<span class="lineNum">     841 </span>                :<span class="lineCov">          1 : void SimulationWorldService::FindNudgeRegion(</span>
<span class="lineNum">     842 </span>                :            :     const apollo::planning::ObjectDecisionType &amp;decision,
<span class="lineNum">     843 </span>                :            :     const Object &amp;world_obj, Decision *world_decision) {
<span class="lineNum">     844 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::FindNudgeRegion&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">     845 </span>                :            : 
<span class="lineNum">     846 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   std::vector&lt;apollo::common::math::Vec2d&gt; points;</span>
<span class="lineNum">     847 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          4 :   for (auto &amp;polygon_pt : world_obj.polygon_point()) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 18 was taken 3 times"> + </span><span class="branchCov" title="Branch 19 was taken 1 time"> + </span>]
<span class="lineNum">     848 </span>[<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          3 :     points.emplace_back(polygon_pt.x(), polygon_pt.y());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     849 </span>                :            :   }
<span class="lineNum">     850 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          2 :   const apollo::common::math::Polygon2d obj_polygon(points);</span>
<span class="lineNum">     851 </span>                :            :   const apollo::common::math::Polygon2d &amp;nudge_polygon =
<span class="lineNum">     852 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          2 :       obj_polygon.ExpandByDistance(std::fabs(decision.nudge().distance_l()));</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     853 </span>                :            :   const std::vector&lt;apollo::common::math::Vec2d&gt; &amp;nudge_points =
<span class="lineNum">     854 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :       nudge_polygon.points();</span>
<span class="lineNum">     855 </span>[<span class="branchCov" title="Branch 3 was taken 67 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>][<span class="branchCov" title="Branch 6 was taken 67 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]:<span class="lineCov">         68 :   for (auto &amp;nudge_pt : nudge_points) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 9 was taken 68 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 67 times"> + </span><span class="branchCov" title="Branch 12 was taken 1 time"> + </span>]
<span class="lineNum">     856 </span>        [<span class="branchCov" title="Branch 1 was taken 67 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         67 :     PolygonPoint *poly_pt = world_decision-&gt;add_polygon_point();</span>
<span class="lineNum">     857 </span>[<span class="branchCov" title="Branch 1 was taken 67 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 67 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         67 :     poly_pt-&gt;set_x(nudge_pt.x());</span>
<span class="lineNum">     858 </span>[<span class="branchCov" title="Branch 1 was taken 67 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 67 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         67 :     poly_pt-&gt;set_y(nudge_pt.y());</span>
<span class="lineNum">     859 </span>                :            :   }
<span class="lineNum">     860 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :   world_decision-&gt;set_type(Decision_Type_NUDGE);</span>
<a name="861"><span class="lineNum">     861 </span>                :<span class="lineCov">          1 : }</span></a>
<span class="lineNum">     862 </span>                :            : 
<span class="lineNum">     863 </span>                :<span class="lineCov">          1 : void SimulationWorldService::UpdateDecision(const DecisionResult &amp;decision_res,</span>
<span class="lineNum">     864 </span>                :            :                                             double header_time) {
<span class="lineNum">     865 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateDecision&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">     866 </span>                :            : 
<span class="lineNum">     867 </span>                :            :   // Update turn signal.
<span class="lineNum">     868 </span>                :<span class="lineCov">          1 :   UpdateTurnSignal(decision_res.vehicle_signal(),</span>
<span class="lineNum">     869 </span>                :<span class="lineCov">          2 :                    world_.mutable_auto_driving_car());</span>
<span class="lineNum">     870 </span>                :            : 
<span class="lineNum">     871 </span>                :<span class="lineCov">          1 :   const auto &amp;main_decision = decision_res.main_decision();</span>
<span class="lineNum">     872 </span>                :            : 
<span class="lineNum">     873 </span>                :            :   // Update speed limit.
<span class="lineNum">     874 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   if (main_decision.target_lane_size() &gt; 0) {</span>
<span class="lineNum">     875 </span>                :<span class="lineCov">          1 :     world_.set_speed_limit(main_decision.target_lane(0).speed_limit());</span>
<span class="lineNum">     876 </span>                :            :   }
<span class="lineNum">     877 </span>                :            : 
<span class="lineNum">     878 </span>                :            :   // Update relevant main stop with reason and change lane.
<span class="lineNum">     879 </span>                :<span class="lineCov">          1 :   world_.clear_main_decision();</span>
<span class="lineNum">     880 </span>                :<span class="lineCov">          1 :   Object *world_main_decision = world_.mutable_main_decision();</span>
<span class="lineNum">     881 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :   if (main_decision.has_not_ready() || main_decision.has_estop() ||</span>
<span class="lineNum">         </span>  [<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>]
<span class="lineNum">     882 </span>                :<span class="lineCov">          1 :       main_decision.has_stop()) {</span>
<span class="lineNum">     883 </span>                :<span class="lineCov">          1 :     UpdateMainStopDecision(main_decision, header_time, world_main_decision);</span>
<span class="lineNum">     884 </span>                :            :   }
<span class="lineNum">     885 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   if (main_decision.has_stop()) {</span>
<span class="lineNum">     886 </span>                :<span class="lineCov">          1 :     UpdateMainChangeLaneDecision(main_decision.stop(), world_main_decision);</span>
<span class="lineNum">     887 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   } else if (main_decision.has_cruise()) {</span>
<span class="lineNum">     888 </span>                :<span class="lineNoCov">          0 :     UpdateMainChangeLaneDecision(main_decision.cruise(), world_main_decision);</span>
<span class="lineNum">     889 </span>                :            :   }
<span class="lineNum">     890 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   if (world_main_decision-&gt;decision_size() &gt; 0) {</span>
<span class="lineNum">     891 </span>                :            :     // set default position
<span class="lineNum">     892 </span>                :<span class="lineCov">          1 :     const auto &amp;adc = world_.auto_driving_car();</span>
<span class="lineNum">     893 </span>                :<span class="lineCov">          1 :     world_main_decision-&gt;set_position_x(adc.position_x());</span>
<span class="lineNum">     894 </span>                :<span class="lineCov">          1 :     world_main_decision-&gt;set_position_y(adc.position_y());</span>
<span class="lineNum">     895 </span>                :<span class="lineCov">          1 :     world_main_decision-&gt;set_heading(adc.heading());</span>
<span class="lineNum">     896 </span>                :<span class="lineCov">          1 :     world_main_decision-&gt;set_timestamp_sec(header_time);</span>
<span class="lineNum">     897 </span>                :            :   }
<span class="lineNum">     898 </span>                :            : 
<span class="lineNum">     899 </span>                :            :   // Update obstacle decision.
<span class="lineNum">     900 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          3 :   for (const auto &amp;obj_decision : decision_res.object_decision().decision()) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 19 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 20 was not taken"> - </span>][<span class="branchCov" title="Branch 21 was taken 2 times"> + </span><span class="branchCov" title="Branch 22 was taken 1 time"> + </span>]
<span class="lineNum">     901 </span>[<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          2 :     if (obj_decision.has_perception_id()) {</span>
<span class="lineNum">     902 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :       int id = obj_decision.perception_id();</span>
<span class="lineNum">     903 </span>[<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          2 :       Object &amp;world_obj = obj_map_[std::to_string(id)];</span>
<span class="lineNum">     904 </span>[<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          2 :       if (!world_obj.has_type()) {</span>
<span class="lineNum">     905 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :         world_obj.set_type(Object_Type_VIRTUAL);</span>
<span class="lineNum">     906 </span>[<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          1 :         ADEBUG &lt;&lt; id &lt;&lt; &quot; is not a current perception object&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>][<span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 1 time"> + </span>]
<span class="lineNum">         </span>[<span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 1 time"> + </span>][<span class="branchNoExec" title="Branch 12 was not executed"> # </span><span class="branchNoExec" title="Branch 13 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 15 was not executed"> # </span><span class="branchNoExec" title="Branch 16 was not executed"> # </span>][<span class="branchNoExec" title="Branch 18 was not executed"> # </span><span class="branchNoExec" title="Branch 19 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 21 was not executed"> # </span><span class="branchNoExec" title="Branch 22 was not executed"> # </span>][<span class="branchNoExec" title="Branch 24 was not executed"> # </span><span class="branchNoExec" title="Branch 25 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 27 was not executed"> # </span><span class="branchNoExec" title="Branch 28 was not executed"> # </span>][<span class="branchNoExec" title="Branch 30 was not executed"> # </span><span class="branchNoExec" title="Branch 31 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 33 was not executed"> # </span><span class="branchNoExec" title="Branch 34 was not executed"> # </span>][<span class="branchNoExec" title="Branch 36 was not executed"> # </span><span class="branchNoExec" title="Branch 37 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 39 was not executed"> # </span><span class="branchNoExec" title="Branch 40 was not executed"> # </span>][<span class="branchNoCov" title="Branch 41 was not taken"> - </span><span class="branchCov" title="Branch 42 was taken 1 time"> + </span>]
<span class="lineNum">         </span>        [<span class="branchNoCov" title="Branch 43 was not taken"> - </span><span class="branchCov" title="Branch 44 was taken 1 time"> + </span>]
<span class="lineNum">         </span>  [<span class="branchNoExec" title="Branch 46 was not executed"> # </span><span class="branchNoExec" title="Branch 47 was not executed"> # </span><span class="branchNoExec" title="Branch 48 was not executed"> # </span><span class="branchNoExec" title="Branch 49 was not executed"> # </span>]
<span class="lineNum">     907 </span>                :            :       }
<span class="lineNum">     908 </span>                :            : 
<span class="lineNum">     909 </span>[<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          4 :       for (const auto &amp;decision : obj_decision.object_decision()) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 18 was taken 2 times"> + </span><span class="branchCov" title="Branch 19 was taken 2 times"> + </span>]
<span class="lineNum">     910 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :         Decision *world_decision = world_obj.add_decision();</span>
<span class="lineNum">     911 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :         world_decision-&gt;set_type(Decision_Type_IGNORE);</span>
<span class="lineNum">     912 </span>[<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          8 :         if (decision.has_stop() || decision.has_follow() ||</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 6 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>][<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchCov" title="Branch 9 was taken 1 time"> + </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchCov" title="Branch 11 was taken 1 time"> + </span>]
<span class="lineNum">     913 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          6 :             decision.has_yield() || decision.has_overtake()) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>][<span class="branchNoCov" title="Branch 8 was not taken"> - </span><span class="branchCov" title="Branch 9 was taken 1 time"> + </span>]
<span class="lineNum">     914 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          1 :           if (!LocateMarker(decision, world_decision)) {</span>
<span class="lineNum">     915 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :             AWARN &lt;&lt; &quot;No decision marker position found for object id=&quot; &lt;&lt; id;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 19 was not executed"> # </span><span class="branchNoExec" title="Branch 20 was not executed"> # </span>]
<span class="lineNum">     916 </span>                :<span class="lineNoCov">          0 :             continue;</span>
<span class="lineNum">     917 </span>                :            :           }
<span class="lineNum">     918 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          1 :           if (decision.has_stop()) {</span>
<span class="lineNum">     919 </span>                :            :             // flag yielded obstacles
<span class="lineNum">     920 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineCov">          1 :             for (auto obstacle_id : decision.stop().wait_for_obstacle()) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>]
<span class="lineNum">         </span>  [<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span><span class="branchNoExec" title="Branch 19 was not executed"> # </span><span class="branchNoExec" title="Branch 20 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 22 was not executed"> # </span><span class="branchNoExec" title="Branch 23 was not executed"> # </span>][<span class="branchNoExec" title="Branch 24 was not executed"> # </span><span class="branchNoExec" title="Branch 25 was not executed"> # </span>]
<span class="lineNum">     921 </span>                :            :               const std::vector&lt;std::string&gt; id_segments =
<span class="lineNum">     922 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                   absl::StrSplit(obstacle_id, '_');</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     923 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :               if (id_segments.size() &gt; 0) {</span>
<span class="lineNum">     924 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 obj_map_[id_segments[0]].set_yielded_obstacle(true);</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     925 </span>                :            :               }
<span class="lineNum">     926 </span>                :<span class="lineNoCov">          0 :             }</span>
<span class="lineNum">     927 </span>                :            :           }
<span class="lineNum">     928 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          1 :         } else if (decision.has_nudge()) {</span>
<span class="lineNum">     929 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :           if (world_obj.polygon_point().empty()) {</span>
<span class="lineNum">         </span>        [<span class="branchNoCov" title="Branch 6 was not taken"> - </span><span class="branchCov" title="Branch 7 was taken 1 time"> + </span>]
<span class="lineNum">     930 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :             if (world_obj.type() == Object_Type_VIRTUAL) {</span>
<span class="lineNum">     931 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :               AWARN &lt;&lt; &quot;No current perception object with id=&quot; &lt;&lt; id</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 19 was not executed"> # </span><span class="branchNoExec" title="Branch 20 was not executed"> # </span>]
<span class="lineNum">     932 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :                     &lt;&lt; &quot; for nudge decision&quot;;</span>
<span class="lineNum">     933 </span>                :            :             } else {
<span class="lineNum">     934 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :               AWARN &lt;&lt; &quot;No polygon points found for object id=&quot; &lt;&lt; id;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 19 was not executed"> # </span><span class="branchNoExec" title="Branch 20 was not executed"> # </span>]
<span class="lineNum">     935 </span>                :            :             }
<span class="lineNum">     936 </span>                :<span class="lineNoCov">          0 :             continue;</span>
<span class="lineNum">     937 </span>                :            :           }
<span class="lineNum">     938 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :           FindNudgeRegion(decision, world_obj, world_decision);</span>
<span class="lineNum">     939 </span>                :            :         }
<span class="lineNum">     940 </span>                :            :       }
<span class="lineNum">     941 </span>                :            : 
<span class="lineNum">     942 </span>                :            :       world_obj.set_timestamp_sec(
<span class="lineNum">     943 </span>[<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          2 :           std::max(world_obj.timestamp_sec(), header_time));</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     944 </span>                :            :     }
<span class="lineNum">     945 </span>                :            :   }
<a name="946"><span class="lineNum">     946 </span>                :<span class="lineCov">          1 : }</span></a>
<span class="lineNum">     947 </span>                :            : 
<span class="lineNum">     948 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::DownsamplePath(const common::Path &amp;path,</span>
<span class="lineNum">     949 </span>                :            :                                             common::Path *downsampled_path) {
<span class="lineNum">     950 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::DownsamplePath&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">     951 </span>                :            : 
<span class="lineNum">     952 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   auto sampled_indices = DownsampleByAngle(path.path_point(), kAngleThreshold);</span>
<span class="lineNum">     953 </span>                :            : 
<span class="lineNum">     954 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   downsampled_path-&gt;set_name(path.name());</span>
<span class="lineNum">     955 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (const size_t index : sampled_indices) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">     956 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     *downsampled_path-&gt;add_path_point() =</span>
<span class="lineNum">     957 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         path.path_point(static_cast&lt;int&gt;(index));</span>
<span class="lineNum">     958 </span>                :<span class="lineNoCov">          0 :   }</span>
<a name="959"><span class="lineNum">     959 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     960 </span>                :            : 
<span class="lineNum">     961 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::UpdatePlanningData(const PlanningData &amp;data) {</span>
<span class="lineNum">     962 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdatePlanningData&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">     963 </span>                :            : 
<span class="lineNum">     964 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   auto *planning_data = world_.mutable_planning_data();</span>
<span class="lineNum">     965 </span>                :            : 
<span class="lineNum">     966 </span>                :<span class="lineNoCov">          0 :   size_t max_interval = 10;</span>
<span class="lineNum">     967 </span>                :            : 
<span class="lineNum">     968 </span>                :            :   // Update scenario
<span class="lineNum">     969 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :   if (data.has_scenario()) {</span>
<span class="lineNum">     970 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     planning_data-&gt;mutable_scenario()-&gt;CopyFrom(data.scenario());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     971 </span>                :            :   }
<span class="lineNum">     972 </span>                :            : 
<span class="lineNum">     973 </span>                :            :   // Update init point
<span class="lineNum">     974 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :   if (data.has_init_point()) {</span>
<span class="lineNum">     975 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     auto &amp;planning_path_point = data.init_point().path_point();</span>
<span class="lineNum">     976 </span>                :            :     auto *world_obj_path_point =
<span class="lineNum">     977 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         planning_data-&gt;mutable_init_point()-&gt;mutable_path_point();</span>
<span class="lineNum">     978 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     world_obj_path_point-&gt;set_x(planning_path_point.x() +</span>
<span class="lineNum">     979 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 map_service_-&gt;GetXOffset());</span>
<span class="lineNum">     980 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     world_obj_path_point-&gt;set_y(planning_path_point.y() +</span>
<span class="lineNum">     981 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 map_service_-&gt;GetYOffset());</span>
<span class="lineNum">     982 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     world_obj_path_point-&gt;set_theta(planning_path_point.theta());</span>
<span class="lineNum">     983 </span>                :            :   }
<span class="lineNum">     984 </span>                :            : 
<span class="lineNum">     985 </span>                :            :   // Update Chart
<span class="lineNum">     986 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   planning_data-&gt;mutable_chart()-&gt;CopyFrom(data.chart());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     987 </span>                :            : 
<span class="lineNum">     988 </span>                :            :   // Update SL Frame
<span class="lineNum">     989 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   planning_data-&gt;mutable_sl_frame()-&gt;CopyFrom(data.sl_frame());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     990 </span>                :            : 
<span class="lineNum">     991 </span>                :            :   // Update DP path
<span class="lineNum">     992 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :   if (data.has_dp_poly_graph()) {</span>
<span class="lineNum">     993 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     planning_data-&gt;mutable_dp_poly_graph()-&gt;CopyFrom(data.dp_poly_graph());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     994 </span>                :            :   }
<span class="lineNum">     995 </span>                :            : 
<span class="lineNum">     996 </span>                :            :   // Update ST Graph
<span class="lineNum">     997 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   planning_data-&gt;clear_st_graph();</span>
<span class="lineNum">     998 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (auto &amp;graph : data.st_graph()) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 18 was not executed"> # </span><span class="branchNoExec" title="Branch 19 was not executed"> # </span>]
<span class="lineNum">     999 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     auto *st_graph = planning_data-&gt;add_st_graph();</span>
<span class="lineNum">    1000 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     st_graph-&gt;set_name(graph.name());</span>
<span class="lineNum">    1001 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     st_graph-&gt;mutable_boundary()-&gt;CopyFrom(graph.boundary());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1002 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (graph.has_kernel_cruise_ref()) {</span>
<span class="lineNum">    1003 </span>                :            :       st_graph-&gt;mutable_kernel_cruise_ref()-&gt;CopyFrom(
<span class="lineNum">    1004 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :           graph.kernel_cruise_ref());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1005 </span>                :            :     }
<span class="lineNum">    1006 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (graph.has_kernel_follow_ref()) {</span>
<span class="lineNum">    1007 </span>                :            :       st_graph-&gt;mutable_kernel_follow_ref()-&gt;CopyFrom(
<span class="lineNum">    1008 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :           graph.kernel_follow_ref());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1009 </span>                :            :     }
<span class="lineNum">    1010 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (graph.has_speed_constraint()) {</span>
<span class="lineNum">    1011 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :       st_graph-&gt;mutable_speed_constraint()-&gt;CopyFrom(graph.speed_constraint());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1012 </span>                :            :     }
<span class="lineNum">    1013 </span>                :            : 
<span class="lineNum">    1014 </span>                :            :     // downsample speed_profile and speed_limit
<span class="lineNum">    1015 </span>                :            :     // The x-axis range is always [-10, 200], downsample to ~200 points but skip
<span class="lineNum">    1016 </span>                :            :     // max 10 points
<span class="lineNum">    1017 </span>                :            :     size_t profile_downsample_interval =
<span class="lineNum">    1018 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         std::max(1, (graph.speed_profile_size() / 200));</span>
<span class="lineNum">    1019 </span>                :            :     profile_downsample_interval =
<span class="lineNum">    1020 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         std::min(profile_downsample_interval, max_interval);</span>
<span class="lineNum">    1021 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     DownsampleSpeedPointsByInterval(graph.speed_profile(),</span>
<span class="lineNum">    1022 </span>                :            :                                     profile_downsample_interval,
<span class="lineNum">    1023 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                     st_graph-&gt;mutable_speed_profile());</span>
<span class="lineNum">    1024 </span>                :            : 
<span class="lineNum">    1025 </span>                :            :     size_t limit_downsample_interval =
<span class="lineNum">    1026 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         std::max(1, (graph.speed_limit_size() / 200));</span>
<span class="lineNum">    1027 </span>                :            :     limit_downsample_interval =
<span class="lineNum">    1028 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         std::min(limit_downsample_interval, max_interval);</span>
<span class="lineNum">    1029 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     DownsampleSpeedPointsByInterval(graph.speed_limit(),</span>
<span class="lineNum">    1030 </span>                :            :                                     limit_downsample_interval,
<span class="lineNum">    1031 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                     st_graph-&gt;mutable_speed_limit());</span>
<span class="lineNum">    1032 </span>                :            :   }
<span class="lineNum">    1033 </span>                :            : 
<span class="lineNum">    1034 </span>                :            :   // Update Speed Plan
<span class="lineNum">    1035 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   planning_data-&gt;clear_speed_plan();</span>
<span class="lineNum">    1036 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (auto &amp;plan : data.speed_plan()) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 18 was not executed"> # </span><span class="branchNoExec" title="Branch 19 was not executed"> # </span>]
<span class="lineNum">    1037 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (plan.speed_point_size() &gt; 0) {</span>
<span class="lineNum">    1038 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :       auto *downsampled_plan = planning_data-&gt;add_speed_plan();</span>
<span class="lineNum">    1039 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :       downsampled_plan-&gt;set_name(plan.name());</span>
<span class="lineNum">    1040 </span>                :            : 
<span class="lineNum">    1041 </span>                :            :       // Downsample the speed plan for frontend display.
<span class="lineNum">    1042 </span>                :            :       // The x-axis range is always [-2, 10], downsample to ~80 points
<span class="lineNum">    1043 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :       size_t interval = std::max(1, (plan.speed_point_size() / 80));</span>
<span class="lineNum">    1044 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :       interval = std::min(interval, max_interval);</span>
<span class="lineNum">    1045 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :       DownsampleSpeedPointsByInterval(plan.speed_point(), interval,</span>
<span class="lineNum">    1046 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                       downsampled_plan-&gt;mutable_speed_point());</span>
<span class="lineNum">    1047 </span>                :            :     }
<span class="lineNum">    1048 </span>                :            :   }
<span class="lineNum">    1049 </span>                :            : 
<span class="lineNum">    1050 </span>                :            :   // Update path
<span class="lineNum">    1051 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   planning_data-&gt;clear_path();</span>
<span class="lineNum">    1052 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (auto &amp;path : data.path()) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 18 was not executed"> # </span><span class="branchNoExec" title="Branch 19 was not executed"> # </span>]
<span class="lineNum">    1053 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     DownsamplePath(path, planning_data-&gt;add_path());</span>
<span class="lineNum">    1054 </span>                :            :   }
<span class="lineNum">    1055 </span>                :            : 
<span class="lineNum">    1056 </span>                :            :   // Update pull over status
<span class="lineNum">    1057 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   planning_data-&gt;clear_pull_over();</span>
<span class="lineNum">    1058 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :   if (data.has_pull_over()) {</span>
<span class="lineNum">    1059 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     planning_data-&gt;mutable_pull_over()-&gt;CopyFrom(data.pull_over());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1060 </span>                :            :   }
<span class="lineNum">    1061 </span>                :            : 
<span class="lineNum">    1062 </span>                :            :   // Update planning signal
<span class="lineNum">    1063 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   world_.clear_traffic_signal();</span>
<span class="lineNum">    1064 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :   if (data.has_signal_light() &amp;&amp; data.signal_light().signal_size() &gt; 0) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>][<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>]
<span class="lineNum">    1065 </span>                :<span class="lineNoCov">          0 :     TrafficLight::Color current_signal = TrafficLight::UNKNOWN;</span>
<span class="lineNum">    1066 </span>                :<span class="lineNoCov">          0 :     int green_light_count = 0;</span>
<span class="lineNum">    1067 </span>                :            : 
<span class="lineNum">    1068 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     for (auto &amp;signal : data.signal_light().signal()) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 19 was not executed"> # </span><span class="branchNoExec" title="Branch 20 was not executed"> # </span>][<span class="branchNoExec" title="Branch 21 was not executed"> # </span><span class="branchNoExec" title="Branch 22 was not executed"> # </span>]
<span class="lineNum">    1069 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :       switch (signal.color()) {</span>
<span class="lineNum">         </span>     [<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<span class="lineNum">    1070 </span>                :            :         case TrafficLight::RED:
<span class="lineNum">    1071 </span>                :            :         case TrafficLight::YELLOW:
<span class="lineNum">    1072 </span>                :            :         case TrafficLight::BLACK:
<span class="lineNum">    1073 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :           current_signal = signal.color();</span>
<span class="lineNum">    1074 </span>                :<span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1075 </span>                :            :         case TrafficLight::GREEN:
<span class="lineNum">    1076 </span>                :<span class="lineNoCov">          0 :           green_light_count++;</span>
<span class="lineNum">    1077 </span>                :<span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1078 </span>                :            :         default:
<span class="lineNum">    1079 </span>                :<span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1080 </span>                :            :       }
<span class="lineNum">    1081 </span>                :            :     }
<span class="lineNum">    1082 </span>                :            : 
<span class="lineNum">    1083 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (green_light_count == data.signal_light().signal_size()) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">    1084 </span>                :<span class="lineNoCov">          0 :       current_signal = TrafficLight::GREEN;</span>
<span class="lineNum">    1085 </span>                :            :     }
<span class="lineNum">    1086 </span>                :            : 
<span class="lineNum">    1087 </span>                :            :     world_.mutable_traffic_signal()-&gt;set_current_signal(
<span class="lineNum">    1088 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         TrafficLight_Color_Name(current_signal));</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1089 </span>                :            :   }
<span class="lineNum">    1090 </span>                :<span class="lineNoCov">          0 : }</span>
<a name="1091"><span class="lineNum">    1091 </span>                :            : </a>
<span class="lineNum">    1092 </span>                :            : template &lt;&gt;
<span class="lineNum">    1093 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::UpdateSimulationWorld(</span>
<span class="lineNum">    1094 </span>                :            :     const ADCTrajectory &amp;trajectory) {
<span class="lineNum">    1095 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   const double header_time = trajectory.header().timestamp_sec();</span>
<span class="lineNum">    1096 </span>                :            : 
<span class="lineNum">    1097 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   UpdatePlanningTrajectory(trajectory);</span>
<span class="lineNum">    1098 </span>                :            : 
<span class="lineNum">    1099 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   UpdateRSSInfo(trajectory);</span>
<span class="lineNum">    1100 </span>                :            : 
<span class="lineNum">    1101 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   UpdateDecision(trajectory.decision(), header_time);</span>
<span class="lineNum">    1102 </span>                :            : 
<span class="lineNum">    1103 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   UpdatePlanningData(trajectory.debug().planning_data());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1104 </span>                :            : 
<span class="lineNum">    1105 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   Latency latency;</span>
<span class="lineNum">    1106 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   latency.set_timestamp_sec(header_time);</span>
<span class="lineNum">    1107 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   latency.set_total_time_ms(trajectory.latency_stats().total_time_ms());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1108 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :   (*world_.mutable_latency())[&quot;planning&quot;] = latency;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<a name="1109"><span class="lineNum">    1109 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1110 </span>                :            : 
<span class="lineNum">    1111 </span>                :<span class="lineCov">          3 : void SimulationWorldService::CreatePredictionTrajectory(</span>
<span class="lineNum">    1112 </span>                :            :     const PredictionObstacle &amp;obstacle, Object *world_object) {
<span class="lineNum">    1113 </span>[<span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          3 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::CreatePredictionTrajectory&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 14 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<span class="lineNum">    1114 </span>                :            : 
<span class="lineNum">    1115 </span>[<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         18 :   for (const auto &amp;traj : obstacle.trajectory()) {</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">         </span>  [<span class="branchCov" title="Branch 10 was taken 15 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span><span class="branchCov" title="Branch 13 was taken 15 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 16 was taken 18 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>][<span class="branchCov" title="Branch 18 was taken 15 times"> + </span><span class="branchCov" title="Branch 19 was taken 3 times"> + </span>]
<span class="lineNum">    1116 </span>        [<span class="branchCov" title="Branch 1 was taken 15 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         15 :     Prediction *prediction = world_object-&gt;add_prediction();</span>
<span class="lineNum">    1117 </span>[<span class="branchCov" title="Branch 1 was taken 15 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 15 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         15 :     prediction-&gt;set_probability(traj.probability());</span>
<span class="lineNum">    1118 </span>                :            : 
<span class="lineNum">    1119 </span>        [<span class="branchCov" title="Branch 1 was taken 15 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         15 :     std::vector&lt;PathPoint&gt; points;</span>
<span class="lineNum">    1120 </span>[<span class="branchCov" title="Branch 1 was taken 15 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 15 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">        135 :     for (const auto &amp;point : traj.trajectory_point()) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 15 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 120 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 120 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 135 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 18 was taken 120 times"> + </span><span class="branchCov" title="Branch 19 was taken 15 times"> + </span>]
<span class="lineNum">    1121 </span>[<span class="branchCov" title="Branch 1 was taken 120 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 120 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">        120 :       points.push_back(point.path_point());</span>
<span class="lineNum">    1122 </span>                :            :     }
<span class="lineNum">    1123 </span>        [<span class="branchCov" title="Branch 1 was taken 15 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         30 :     auto sampled_indices = DownsampleByAngle(points, kAngleThreshold);</span>
<span class="lineNum">    1124 </span>                :            : 
<span class="lineNum">    1125 </span>[<span class="branchCov" title="Branch 3 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>][<span class="branchCov" title="Branch 6 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]:<span class="lineCov">         45 :     for (auto index : sampled_indices) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 9 was taken 45 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 30 times"> + </span><span class="branchCov" title="Branch 12 was taken 15 times"> + </span>]
<span class="lineNum">    1126 </span>        [<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         30 :       const auto &amp;point = points[index];</span>
<span class="lineNum">    1127 </span>        [<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         30 :       PolygonPoint *world_point = prediction-&gt;add_predicted_trajectory();</span>
<span class="lineNum">    1128 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :       world_point-&gt;set_x(point.x() + map_service_-&gt;GetXOffset());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">    1129 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         30 :       world_point-&gt;set_y(point.y() + map_service_-&gt;GetYOffset());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">    1130 </span>                :            : 
<span class="lineNum">    1131 </span>        [<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         30 :       const TrajectoryPoint &amp;traj_point = traj.trajectory_point(index);</span>
<span class="lineNum">    1132 </span>[<span class="branchCov" title="Branch 1 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 30 times"> + </span>]:<span class="lineCov">         30 :       if (traj_point.has_gaussian_info()) {</span>
<span class="lineNum">    1133 </span>                :            :         const apollo::common::GaussianInfo &amp;gaussian =
<span class="lineNum">    1134 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :             traj_point.gaussian_info();</span>
<span class="lineNum">    1135 </span>                :            : 
<span class="lineNum">    1136 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         auto *ellipse = world_point-&gt;mutable_gaussian_info();</span>
<span class="lineNum">    1137 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         ellipse-&gt;set_ellipse_a(gaussian.ellipse_a());</span>
<span class="lineNum">    1138 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         ellipse-&gt;set_ellipse_b(gaussian.ellipse_b());</span>
<span class="lineNum">    1139 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         ellipse-&gt;set_theta_a(gaussian.theta_a());</span>
<span class="lineNum">    1140 </span>                :            :       }
<span class="lineNum">    1141 </span>                :            :     }
<span class="lineNum">    1142 </span>                :<span class="lineCov">         15 :   }</span>
<span class="lineNum">    1143 </span>                :<span class="lineCov">          3 : }</span>
<a name="1144"><span class="lineNum">    1144 </span>                :            : </a>
<span class="lineNum">    1145 </span>                :            : template &lt;&gt;
<span class="lineNum">    1146 </span>                :<span class="lineCov">          1 : void SimulationWorldService::UpdateSimulationWorld(</span>
<span class="lineNum">    1147 </span>                :            :     const PredictionObstacles &amp;obstacles) {
<span class="lineNum">    1148 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          4 :   for (const auto &amp;obstacle : obstacles.prediction_obstacle()) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 18 was taken 3 times"> + </span><span class="branchCov" title="Branch 19 was taken 1 time"> + </span>]
<span class="lineNum">    1149 </span>                :            :     // Note: There's a perfect one-to-one mapping between the perception
<span class="lineNum">    1150 </span>                :            :     // obstacles and prediction obstacles within the same frame. Creating a new
<span class="lineNum">    1151 </span>                :            :     // world object here is only possible when we happen to be processing a
<span class="lineNum">    1152 </span>                :            :     // perception and prediction message from two frames.
<span class="lineNum">    1153 </span>[<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          3 :     auto &amp;world_obj = CreateWorldObjectIfAbsent(obstacle.perception_obstacle());</span>
<span class="lineNum">    1154 </span>                :            : 
<span class="lineNum">    1155 </span>                :            :     // Add prediction trajectory to the object.
<span class="lineNum">    1156 </span>        [<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          3 :     CreatePredictionTrajectory(obstacle, &amp;world_obj);</span>
<span class="lineNum">    1157 </span>                :            : 
<span class="lineNum">    1158 </span>                :            :     // Add prediction priority
<span class="lineNum">    1159 </span>[<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 3 times"> + </span>]:<span class="lineCov">          3 :     if (obstacle.has_priority()) {</span>
<span class="lineNum">    1160 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :       world_obj.mutable_obstacle_priority()-&gt;CopyFrom(obstacle.priority());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1161 </span>                :            :     }
<span class="lineNum">    1162 </span>                :            : 
<span class="lineNum">    1163 </span>                :            :     world_obj.set_timestamp_sec(
<span class="lineNum">    1164 </span>[<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          3 :         std::max(obstacle.timestamp(), world_obj.timestamp_sec()));</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">    1165 </span>                :            :   }
<span class="lineNum">    1166 </span>                :<span class="lineCov">          1 : }</span>
<a name="1167"><span class="lineNum">    1167 </span>                :            : </a>
<span class="lineNum">    1168 </span>                :            : template &lt;&gt;
<span class="lineNum">    1169 </span>                :<span class="lineCov">          1 : void SimulationWorldService::UpdateSimulationWorld(</span>
<span class="lineNum">    1170 </span>                :            :     const RoutingResponse &amp;routing_response) {
<span class="lineNum">    1171 </span>                :            :   {
<span class="lineNum">    1172 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :     boost::shared_lock&lt;boost::shared_mutex&gt; reader_lock(route_paths_mutex_);</span>
<span class="lineNum">    1173 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          1 :     if (world_.has_routing_time() &amp;&amp;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>][<span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 1 time"> + </span>]
<span class="lineNum">    1174 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         world_.routing_time() == routing_response.header().timestamp_sec()) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1175 </span>                :            :       // This routing response has been processed.
<span class="lineNum">    1176 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :       return;</span>
<span class="lineNum">    1177 </span>                :<span class="lineCov">          1 :     }</span>
<span class="lineNum">    1178 </span>                :            :   }
<span class="lineNum">    1179 </span>                :            : 
<span class="lineNum">    1180 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   std::vector&lt;Path&gt; paths;</span>
<span class="lineNum">    1181 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (!map_service_-&gt;GetPathsFromRouting(routing_response, &amp;paths)) {</span>
<span class="lineNum">    1182 </span>                :<span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">    1183 </span>                :            :   }
<span class="lineNum">    1184 </span>                :            : 
<span class="lineNum">    1185 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   world_.clear_route_path();</span>
<span class="lineNum">    1186 </span>                :            : 
<span class="lineNum">    1187 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          2 :   std::vector&lt;RoutePath&gt; route_paths;</span>
<span class="lineNum">    1188 </span>  [<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]:<span class="lineCov">          2 :   for (const Path &amp;path : paths) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 9 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 1 time"> + </span><span class="branchCov" title="Branch 12 was taken 1 time"> + </span>]
<span class="lineNum">    1189 </span>                :            :     // Downsample the path points for frontend display.
<span class="lineNum">    1190 </span>                :            :     auto sampled_indices =
<span class="lineNum">    1191 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :         DownsampleByAngle(path.path_points(), kAngleThreshold);</span>
<span class="lineNum">    1192 </span>                :            : 
<span class="lineNum">    1193 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :     route_paths.emplace_back();</span>
<span class="lineNum">    1194 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :     RoutePath *route_path = &amp;route_paths.back();</span>
<span class="lineNum">    1195 </span>[<span class="branchCov" title="Branch 3 was taken 23 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>][<span class="branchCov" title="Branch 6 was taken 23 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]:<span class="lineCov">         24 :     for (const size_t index : sampled_indices) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 9 was taken 24 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 23 times"> + </span><span class="branchCov" title="Branch 12 was taken 1 time"> + </span>]
<span class="lineNum">    1196 </span>[<span class="branchCov" title="Branch 1 was taken 23 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 23 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         23 :       const auto &amp;path_point = path.path_points()[index];</span>
<span class="lineNum">    1197 </span>        [<span class="branchCov" title="Branch 1 was taken 23 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         23 :       PolygonPoint *route_point = route_path-&gt;add_point();</span>
<span class="lineNum">    1198 </span>[<span class="branchCov" title="Branch 1 was taken 23 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 23 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         23 :       route_point-&gt;set_x(path_point.x() + map_service_-&gt;GetXOffset());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 23 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">    1199 </span>[<span class="branchCov" title="Branch 1 was taken 23 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 23 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         23 :       route_point-&gt;set_y(path_point.y() + map_service_-&gt;GetYOffset());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 23 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">    1200 </span>                :            :     }
<span class="lineNum">    1201 </span>                :            : 
<span class="lineNum">    1202 </span>                :            :     // Populate route path
<span class="lineNum">    1203 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :     if (FLAGS_sim_world_with_routing_path) {</span>
<span class="lineNum">    1204 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :       auto *new_path = world_.add_route_path();</span>
<span class="lineNum">    1205 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :       *new_path = *route_path;</span>
<span class="lineNum">    1206 </span>                :            :     }
<span class="lineNum">    1207 </span>                :<span class="lineCov">          1 :   }</span>
<span class="lineNum">    1208 </span>                :            :   {
<span class="lineNum">    1209 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :     boost::unique_lock&lt;boost::shared_mutex&gt; writer_lock(route_paths_mutex_);</span>
<span class="lineNum">    1210 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :     std::swap(route_paths, route_paths_);</span>
<span class="lineNum">    1211 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :     world_.set_routing_time(routing_response.header().timestamp_sec());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">    1212 </span>                :<span class="lineCov">          1 :   }</span>
<a name="1213"><span class="lineNum">    1213 </span>                :            : }</a>
<span class="lineNum">    1214 </span>                :            : 
<span class="lineNum">    1215 </span>                :<span class="lineNoCov">          0 : Json SimulationWorldService::GetRoutePathAsJson() const {</span>
<span class="lineNum">    1216 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::GetRoutePathAsJson&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">    1217 </span>                :            : 
<span class="lineNum">    1218 </span>                :<span class="lineNoCov">          0 :   Json response;</span>
<span class="lineNum">    1219 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   response[&quot;routePath&quot;] = Json::array();</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 12 was not executed"> # </span><span class="branchNoExec" title="Branch 13 was not executed"> # </span>]
<span class="lineNum">    1220 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   std::vector&lt;RoutePath&gt; route_paths;</span>
<span class="lineNum">    1221 </span>                :            :   {
<span class="lineNum">    1222 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     boost::shared_lock&lt;boost::shared_mutex&gt; reader_lock(route_paths_mutex_);</span>
<span class="lineNum">    1223 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     response[&quot;routingTime&quot;] = world_.routing_time();</span>
<span class="lineNum">    1224 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     route_paths = route_paths_;</span>
<span class="lineNum">    1225 </span>                :            :   }
<span class="lineNum">    1226 </span>  [<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (const auto &amp;route_path : route_paths) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">    1227 </span>                :<span class="lineNoCov">          0 :     Json path;</span>
<span class="lineNum">    1228 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     path[&quot;point&quot;] = Json::array();</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 12 was not executed"> # </span><span class="branchNoExec" title="Branch 13 was not executed"> # </span>]
<span class="lineNum">    1229 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     for (const auto &amp;route_point : route_path.point()) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 18 was not executed"> # </span><span class="branchNoExec" title="Branch 19 was not executed"> # </span>]
<span class="lineNum">    1230 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :       path[&quot;point&quot;].push_back({{&quot;x&quot;, route_point.x()},</span>
<span class="lineNum">    1231 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                {&quot;y&quot;, route_point.y()},</span>
<span class="lineNum">    1232 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                {&quot;z&quot;, route_point.z()}});</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 19 was not executed"> # </span><span class="branchNoExec" title="Branch 20 was not executed"> # </span>][<span class="branchNoExec" title="Branch 22 was not executed"> # </span><span class="branchNoExec" title="Branch 23 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 25 was not executed"> # </span><span class="branchNoExec" title="Branch 26 was not executed"> # </span>][<span class="branchNoExec" title="Branch 28 was not executed"> # </span><span class="branchNoExec" title="Branch 29 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 31 was not executed"> # </span><span class="branchNoExec" title="Branch 32 was not executed"> # </span>][<span class="branchNoExec" title="Branch 33 was not executed"> # </span><span class="branchNoExec" title="Branch 34 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 36 was not executed"> # </span><span class="branchNoExec" title="Branch 37 was not executed"> # </span>][<span class="branchNoExec" title="Branch 39 was not executed"> # </span><span class="branchNoExec" title="Branch 40 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 42 was not executed"> # </span><span class="branchNoExec" title="Branch 43 was not executed"> # </span>][<span class="branchNoExec" title="Branch 45 was not executed"> # </span><span class="branchNoExec" title="Branch 46 was not executed"> # </span> 
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 48 was not executed"> # </span><span class="branchNoExec" title="Branch 49 was not executed"> # </span><span class="branchNoExec" title="Branch 51 was not executed"> # </span><span class="branchNoExec" title="Branch 52 was not executed"> # </span><span class="branchNoExec" title="Branch 54 was not executed"> # </span> 
<span class="lineNum">         </span>            <span class="branchNoExec" title="Branch 55 was not executed"> # </span>]
<span class="lineNum">    1233 </span>                :            :     }
<span class="lineNum">    1234 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     response[&quot;routePath&quot;].push_back(path);</span>
<span class="lineNum">    1235 </span>                :<span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1236 </span>                :<span class="lineNoCov">          0 :   return response;</span>
<a name="1237"><span class="lineNum">    1237 </span>                :            : }</a>
<span class="lineNum">    1238 </span>                :            : 
<span class="lineNum">    1239 </span>                :<span class="lineCov">          1 : void SimulationWorldService::ReadRoutingFromFile(</span>
<span class="lineNum">    1240 </span>                :            :     const std::string &amp;routing_response_file) {
<span class="lineNum">    1241 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::ReadRoutingFromFile&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">    1242 </span>                :            : 
<span class="lineNum">    1243 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   auto routing_response = std::make_shared&lt;RoutingResponse&gt;();</span>
<span class="lineNum">    1244 </span>[<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1 time"> + </span>]:<span class="lineCov">          1 :   if (!GetProtoFromFile(routing_response_file, routing_response.get())) {</span>
<span class="lineNum">    1245 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AWARN &lt;&lt; &quot;Unable to read routing response from file: &quot;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">    1246 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :           &lt;&lt; routing_response_file;</span>
<span class="lineNum">    1247 </span>                :<span class="lineCov">          1 :     return;</span>
<span class="lineNum">    1248 </span>                :            :   }
<span class="lineNum">    1249 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :   AINFO &lt;&lt; &quot;Loaded routing from &quot; &lt;&lt; routing_response_file;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 19 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 20 was not taken"> - </span>]
<span class="lineNum">    1250 </span>                :            : 
<span class="lineNum">    1251 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :   sleep(1);  // Wait to make sure the connection has been established before</span>
<span class="lineNum">    1252 </span>                :            :              // publishing.
<span class="lineNum">    1253 </span>        [<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          1 :   routing_response_writer_-&gt;Write(routing_response);</span>
<span class="lineNum">    1254 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :   AINFO &lt;&lt; &quot;Published RoutingResponse read from file.&quot;;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 13 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span>][<span class="branchCov" title="Branch 16 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 20 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<span class="lineNum">    1255 </span>                :            : }
<a name="1256"><span class="lineNum">    1256 </span>                :            : </a>
<span class="lineNum">    1257 </span>                :            : template &lt;&gt;
<span class="lineNum">    1258 </span>                :<span class="lineCov">          2 : void SimulationWorldService::UpdateSimulationWorld(</span>
<span class="lineNum">    1259 </span>                :            :     const ControlCommand &amp;control_command) {
<span class="lineNum">    1260 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :   auto *control_data = world_.mutable_control_data();</span>
<span class="lineNum">    1261 </span>[<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          2 :   const double header_time = control_command.header().timestamp_sec();</span>
<span class="lineNum">    1262 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :   control_data-&gt;set_timestamp_sec(header_time);</span>
<span class="lineNum">    1263 </span>                :            : 
<span class="lineNum">    1264 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :   Latency latency;</span>
<span class="lineNum">    1265 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :   latency.set_timestamp_sec(header_time);</span>
<span class="lineNum">    1266 </span>[<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          2 :   latency.set_total_time_ms(control_command.latency_stats().total_time_ms());</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">    1267 </span>[<span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 5 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]:<span class="lineCov">          2 :   (*world_.mutable_latency())[&quot;control&quot;] = latency;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 8 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>][<span class="branchCov" title="Branch 11 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span>]
<span class="lineNum">    1268 </span>                :            : 
<span class="lineNum">    1269 </span>[<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          2 :   if (control_command.has_debug()) {</span>
<span class="lineNum">    1270 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          2 :     auto &amp;debug = control_command.debug();</span>
<span class="lineNum">    1271 </span>[<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          2 :     if (debug.has_simple_lon_debug() &amp;&amp; debug.has_simple_lat_debug()) {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>][<span class="branchCov" title="Branch 8 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchCov" title="Branch 11 was taken 1 time"> + </span>]
<span class="lineNum">    1272 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :       auto &amp;simple_lon = debug.simple_lon_debug();</span>
<span class="lineNum">    1273 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          1 :       if (simple_lon.has_station_error()) {</span>
<span class="lineNum">    1274 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :         control_data-&gt;set_station_error(simple_lon.station_error());</span>
<span class="lineNum">    1275 </span>                :            :       }
<span class="lineNum">    1276 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :       auto &amp;simple_lat = debug.simple_lat_debug();</span>
<span class="lineNum">    1277 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          1 :       if (simple_lat.has_heading_error()) {</span>
<span class="lineNum">    1278 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :         control_data-&gt;set_heading_error(simple_lat.heading_error());</span>
<span class="lineNum">    1279 </span>                :            :       }
<span class="lineNum">    1280 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          1 :       if (simple_lat.has_lateral_error()) {</span>
<span class="lineNum">    1281 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :         control_data-&gt;set_lateral_error(simple_lat.lateral_error());</span>
<span class="lineNum">    1282 </span>                :            :       }
<span class="lineNum">    1283 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          1 :       if (simple_lat.has_current_target_point()) {</span>
<span class="lineNum">    1284 </span>                :            :         control_data-&gt;mutable_current_target_point()-&gt;CopyFrom(
<span class="lineNum">    1285 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineCov">          1 :             simple_lat.current_target_point());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1286 </span>                :            :       }
<span class="lineNum">    1287 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          1 :     } else if (debug.has_simple_mpc_debug()) {</span>
<span class="lineNum">    1288 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :       auto &amp;simple_mpc = debug.simple_mpc_debug();</span>
<span class="lineNum">    1289 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          1 :       if (simple_mpc.has_station_error()) {</span>
<span class="lineNum">    1290 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :         control_data-&gt;set_station_error(simple_mpc.station_error());</span>
<span class="lineNum">    1291 </span>                :            :       }
<span class="lineNum">    1292 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          1 :       if (simple_mpc.has_heading_error()) {</span>
<span class="lineNum">    1293 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          1 :         control_data-&gt;set_heading_error(simple_mpc.heading_error());</span>
<span class="lineNum">    1294 </span>                :            :       }
<span class="lineNum">    1295 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          1 :       if (simple_mpc.has_lateral_error()) {</span>
<span class="lineNum">    1296 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          2 :         control_data-&gt;set_lateral_error(simple_mpc.lateral_error());</span>
<span class="lineNum">    1297 </span>                :            :       }
<span class="lineNum">    1298 </span>                :            :     }
<span class="lineNum">    1299 </span>                :<span class="lineCov">          2 :   }</span>
<span class="lineNum">    1300 </span>                :<span class="lineCov">          2 : }</span>
<a name="1301"><span class="lineNum">    1301 </span>                :            : </a>
<span class="lineNum">    1302 </span>                :            : template &lt;&gt;
<span class="lineNum">    1303 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::UpdateSimulationWorld(</span>
<span class="lineNum">    1304 </span>                :            :     const NavigationInfo &amp;navigation_info) {
<span class="lineNum">    1305 </span>                :<span class="lineNoCov">          0 :   world_.clear_navigation_path();</span>
<span class="lineNum">    1306 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (auto &amp;navigation_path : navigation_info.navigation_path()) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 18 was not executed"> # </span><span class="branchNoExec" title="Branch 19 was not executed"> # </span>]
<span class="lineNum">    1307 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (navigation_path.has_path()) {</span>
<span class="lineNum">    1308 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :       DownsamplePath(navigation_path.path(), world_.add_navigation_path());</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">    1309 </span>                :            :     }
<span class="lineNum">    1310 </span>                :            :   }
<span class="lineNum">    1311 </span>                :<span class="lineNoCov">          0 : }</span>
<a name="1312"><span class="lineNum">    1312 </span>                :            : </a>
<span class="lineNum">    1313 </span>                :            : template &lt;&gt;
<span class="lineNum">    1314 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::UpdateSimulationWorld(const MapMsg &amp;map_msg) {</span>
<span class="lineNum">    1315 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateSimulationWorld&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">    1316 </span>                :            : 
<span class="lineNum">    1317 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   if (map_msg.has_hdmap()) {</span>
<span class="lineNum">    1318 </span>                :<span class="lineNoCov">          0 :     relative_map_.CopyFrom(map_msg.hdmap());</span>
<span class="lineNum">    1319 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     for (int i = 0; i &lt; relative_map_.lane_size(); ++i) {</span>
<span class="lineNum">    1320 </span>                :<span class="lineNoCov">          0 :       auto *lane = relative_map_.mutable_lane(i);</span>
<span class="lineNum">    1321 </span>                :<span class="lineNoCov">          0 :       lane-&gt;clear_left_sample();</span>
<span class="lineNum">    1322 </span>                :<span class="lineNoCov">          0 :       lane-&gt;clear_right_sample();</span>
<span class="lineNum">    1323 </span>                :<span class="lineNoCov">          0 :       lane-&gt;clear_left_road_sample();</span>
<span class="lineNum">    1324 </span>                :<span class="lineNoCov">          0 :       lane-&gt;clear_right_road_sample();</span>
<span class="lineNum">    1325 </span>                :            : 
<span class="lineNum">    1326 </span>                :<span class="lineNoCov">          0 :       DownsampleCurve(lane-&gt;mutable_central_curve());</span>
<span class="lineNum">    1327 </span>                :<span class="lineNoCov">          0 :       DownsampleCurve(lane-&gt;mutable_left_boundary()-&gt;mutable_curve());</span>
<span class="lineNum">    1328 </span>                :<span class="lineNoCov">          0 :       DownsampleCurve(lane-&gt;mutable_right_boundary()-&gt;mutable_curve());</span>
<span class="lineNum">    1329 </span>                :            :     }
<span class="lineNum">    1330 </span>                :            :   }
<span class="lineNum">    1331 </span>                :<span class="lineNoCov">          0 : }</span>
<a name="1332"><span class="lineNum">    1332 </span>                :            : </a>
<span class="lineNum">    1333 </span>                :            : template &lt;&gt;
<span class="lineNum">    1334 </span>                :<span class="lineCov">          3 : void SimulationWorldService::UpdateSimulationWorld(</span>
<span class="lineNum">    1335 </span>                :            :     const MonitorMessage &amp;monitor_msg) {
<span class="lineNum">    1336 </span>                :<span class="lineCov">          3 :   const int updated_size = std::min(monitor_msg.item_size(),</span>
<span class="lineNum">    1337 </span>        [<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          3 :                                     SimulationWorldService::kMaxMonitorItems);</span>
<span class="lineNum">    1338 </span>                :            :   // Save the latest messages at the end of the history.
<span class="lineNum">    1339 </span>        [<span class="branchCov" title="Branch 0 was taken 33 times"> + </span><span class="branchCov" title="Branch 1 was taken 3 times"> + </span>]:<span class="lineCov">         36 :   for (int idx = 0; idx &lt; updated_size; ++idx) {</span>
<span class="lineNum">    1340 </span>                :<span class="lineCov">         33 :     auto *notification = world_.add_notification();</span>
<span class="lineNum">    1341 </span>                :<span class="lineCov">         33 :     notification-&gt;mutable_item()-&gt;CopyFrom(monitor_msg.item(idx));</span>
<span class="lineNum">    1342 </span>                :<span class="lineCov">         33 :     notification-&gt;set_timestamp_sec(monitor_msg.header().timestamp_sec());</span>
<span class="lineNum">    1343 </span>                :            :   }
<span class="lineNum">    1344 </span>                :            : 
<span class="lineNum">    1345 </span>                :            :   int remove_size =
<span class="lineNum">    1346 </span>                :<span class="lineCov">          3 :       world_.notification_size() - SimulationWorldService::kMaxMonitorItems;</span>
<span class="lineNum">    1347 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">          3 :   if (remove_size &gt; 0) {</span>
<span class="lineNum">    1348 </span>                :<span class="lineCov">          1 :     auto *notifications = world_.mutable_notification();</span>
<span class="lineNum">    1349 </span>                :            :     notifications-&gt;erase(notifications-&gt;begin(),
<span class="lineNum">    1350 </span>[<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>][<span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]:<span class="lineCov">          1 :                          notifications-&gt;begin() + remove_size);</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 9 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>][<span class="branchCov" title="Branch 12 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 13 was not taken"> - </span>]
<span class="lineNum">    1351 </span>                :            :   }
<a name="1352"><span class="lineNum">    1352 </span>                :<span class="lineCov">          3 : }</span></a>
<span class="lineNum">    1353 </span>                :            : 
<span class="lineNum">    1354 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::UpdateMonitorMessages() {</span>
<span class="lineNum">    1355 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::UpdateMonitorMessages&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>][<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>]
<span class="lineNum">    1356 </span>                :            : 
<span class="lineNum">    1357 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   std::list&lt;std::shared_ptr&lt;MonitorMessage&gt;&gt; monitor_msgs;</span>
<span class="lineNum">    1358 </span>                :            :   {
<span class="lineNum">    1359 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     std::unique_lock&lt;std::mutex&gt; lock(monitor_msgs_mutex_);</span>
<span class="lineNum">    1360 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     monitor_msgs = monitor_msgs_;</span>
<span class="lineNum">    1361 </span>                :<span class="lineNoCov">          0 :     monitor_msgs_.clear();</span>
<span class="lineNum">    1362 </span>                :            :   }
<span class="lineNum">    1363 </span>                :            : 
<span class="lineNum">    1364 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (const auto &amp;monitor_msg : monitor_msgs) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">    1365 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :     UpdateSimulationWorld(*monitor_msg);</span>
<span class="lineNum">    1366 </span>                :<span class="lineNoCov">          0 :   }</span>
<a name="1367"><span class="lineNum">    1367 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1368 </span>                :            : 
<span class="lineNum">    1369 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::DumpMessages() {</span>
<span class="lineNum">    1370 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::DumpMessages&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">    1371 </span>                :            : 
<span class="lineNum">    1372 </span>                :<span class="lineNoCov">          0 :   DumpMessageFromReader(chassis_reader_.get());</span>
<span class="lineNum">    1373 </span>                :<span class="lineNoCov">          0 :   DumpMessageFromReader(prediction_obstacle_reader_.get());</span>
<span class="lineNum">    1374 </span>                :<span class="lineNoCov">          0 :   DumpMessageFromReader(routing_request_reader_.get());</span>
<span class="lineNum">    1375 </span>                :<span class="lineNoCov">          0 :   DumpMessageFromReader(routing_response_reader_.get());</span>
<span class="lineNum">    1376 </span>                :<span class="lineNoCov">          0 :   DumpMessageFromReader(localization_reader_.get());</span>
<span class="lineNum">    1377 </span>                :<span class="lineNoCov">          0 :   DumpMessageFromReader(planning_reader_.get());</span>
<span class="lineNum">    1378 </span>                :<span class="lineNoCov">          0 :   DumpMessageFromReader(control_command_reader_.get());</span>
<span class="lineNum">    1379 </span>                :<span class="lineNoCov">          0 :   DumpMessageFromReader(perception_obstacle_reader_.get());</span>
<span class="lineNum">    1380 </span>                :<span class="lineNoCov">          0 :   DumpMessageFromReader(perception_traffic_light_reader_.get());</span>
<span class="lineNum">    1381 </span>                :<span class="lineNoCov">          0 :   DumpMessageFromReader(relative_map_reader_.get());</span>
<span class="lineNum">    1382 </span>                :<span class="lineNoCov">          0 :   DumpMessageFromReader(navigation_reader_.get());</span>
<a name="1383"><span class="lineNum">    1383 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1384 </span>                :            : 
<span class="lineNum">    1385 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::PublishNavigationInfo(</span>
<span class="lineNum">    1386 </span>                :            :     const std::shared_ptr&lt;NavigationInfo&gt; &amp;navigation_info) {
<span class="lineNum">    1387 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::PublishNavigationInfo&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">    1388 </span>                :            : 
<span class="lineNum">    1389 </span>                :<span class="lineNoCov">          0 :   FillHeader(FLAGS_dreamview_module_name, navigation_info.get());</span>
<span class="lineNum">    1390 </span>                :<span class="lineNoCov">          0 :   navigation_writer_-&gt;Write(navigation_info);</span>
<a name="1391"><span class="lineNum">    1391 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1392 </span>                :            : 
<span class="lineNum">    1393 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::PublishRoutingRequest(</span>
<span class="lineNum">    1394 </span>                :            :     const std::shared_ptr&lt;RoutingRequest&gt; &amp;routing_request) {
<span class="lineNum">    1395 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::PublishRoutingRequest&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">    1396 </span>                :            : 
<span class="lineNum">    1397 </span>                :<span class="lineNoCov">          0 :   FillHeader(FLAGS_dreamview_module_name, routing_request.get());</span>
<span class="lineNum">    1398 </span>                :<span class="lineNoCov">          0 :   routing_request_writer_-&gt;Write(routing_request);</span>
<a name="1399"><span class="lineNum">    1399 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1400 </span>                :            : 
<span class="lineNum">    1401 </span>                :<span class="lineNoCov">          0 : void SimulationWorldService::PublishMonitorMessage(</span>
<span class="lineNum">    1402 </span>                :            :     apollo::common::monitor::MonitorMessageItem::LogLevel log_level,
<span class="lineNum">    1403 </span>                :            :     const std::string &amp;msg) {
<span class="lineNum">    1404 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     AINFO&lt;&lt;&quot;(DMCZP) EnteringMethod: SimulationWorldService::PublishMonitorMessage&quot;;</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">    1405 </span>                :            : 
<span class="lineNum">    1406 </span>                :<span class="lineNoCov">          0 :   monitor_logger_buffer_.AddMonitorMsgItem(log_level, msg);</span>
<span class="lineNum">    1407 </span>                :<span class="lineNoCov">          0 :   monitor_logger_buffer_.Publish();</span>
<a name="1408"><span class="lineNum">    1408 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1409 </span>                :            : }  // namespace dreamview
<span class="lineNum">    1410 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineCov">          4 : }  // namespace apollo</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>][<span class="branchCov" title="Branch 9 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>]
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
